<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>libmseed: Examples</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">libmseed<span id="projectnumber">&#160;3.0.10</span>
   </div>
   <div id="projectbrief">The miniSEED data format library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Examples </div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#examples-overview">Overview</a></li>
<li class="level1"><a href="#example-mseedview">Read miniSEED from files</a></li>
<li class="level1"><a href="#example-lm_read_selection">Reading with selections</a></li>
<li class="level1"><a href="#example-lm_read_recordlist">Reading with record lists</a></li>
<li class="level1"><a href="#example-lm_read_buffer">Reading from memory buffers</a></li>
<li class="level1"><a href="#example-lm_pararead">Reading files in parallel</a></li>
<li class="level1"><a href="#example-lm_pack">Writing miniSEED</a></li>
<li class="level1"><a href="#example-lm_pack_rollingbuffer">Writing miniSEED with rolling buffer</a></li>
<li class="level1"><a href="#example-lm_sids">Working with Source Identifiers</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="examples-overview"></a>
Overview</h1>
<p >The most basic usage of the library is illustrated in the <a class="el" href="page-tutorial.html">Tutorial</a>. This page contains full example programs that utilize the library for common tasks. These examples are included in the source distribution and (most) are used in the test suite.</p>
<p >While these are full working programs the aspects not related to library usage, e.g. argument parsing, are often minimized and left uncommented as they will change in real world usage.</p>
<h1><a class="anchor" id="example-mseedview"></a>
Read miniSEED from files</h1>
<p >A simple program to read miniSEED from files and print details from each record:</p>
<div class="fragment"><div class="line"><span class="comment">/***************************************************************************</span></div>
<div class="line"><span class="comment"> * A simple example of using libmseed to read miniSEED.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Opens a user specified file, parses the miniSEED records and prints</span></div>
<div class="line"><span class="comment"> * details for each record.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * This file is part of the miniSEED Library.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Copyright (c) 2020 Chad Trabant, IRIS Data Management Center</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span></div>
<div class="line"><span class="comment"> * you may not use this file except in compliance with the License.</span></div>
<div class="line"><span class="comment"> * You may obtain a copy of the License at</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *   http://www.apache.org/licenses/LICENSE-2.0</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Unless required by applicable law or agreed to in writing, software</span></div>
<div class="line"><span class="comment"> * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></div>
<div class="line"><span class="comment"> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></div>
<div class="line"><span class="comment"> * See the License for the specific language governing permissions and</span></div>
<div class="line"><span class="comment"> * limitations under the License.</span></div>
<div class="line"><span class="comment"> ***************************************************************************/</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;errno.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;time.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="libmseed_8h.html">libmseed.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define VERSION &quot;[libmseed &quot;</span> LIBMSEED_VERSION &quot; example]&quot;</div>
<div class="line"><span class="preprocessor">#define PACKAGE &quot;mseedview&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> int8_t verbose = 0;</div>
<div class="line"><span class="keyword">static</span> int8_t ppackets = 0;</div>
<div class="line"><span class="keyword">static</span> int8_t basicsum = 0;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> printdata = 0;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">char</span> *inputfile = NULL;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> parameter_proc (<span class="keywordtype">int</span> argcount, <span class="keywordtype">char</span> **argvec);</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> usage (<span class="keywordtype">void</span>);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span></div>
<div class="line">main (<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)</div>
<div class="line">{</div>
<div class="line">  <a class="code hl_struct" href="group__miniseed-record.html#struct_m_s3_record">MS3Record</a> *msr = NULL;</div>
<div class="line">  uint32_t flags = 0;</div>
<div class="line"> </div>
<div class="line">  int64_t totalrecs = 0;</div>
<div class="line">  int64_t totalsamps = 0;</div>
<div class="line">  <span class="keywordtype">int</span> retcode;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* Process command line arguments */</span></div>
<div class="line">  <span class="keywordflow">if</span> (parameter_proc (argc, argv) &lt; 0)</div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* Set flag to validate CRCs when reading */</span></div>
<div class="line">  flags |= <a class="code hl_define" href="group__control-flags.html#gab06edaad68767eb4f5603d3fcb3eeb13">MSF_VALIDATECRC</a>;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* Parse byte range from file/URL path name if present */</span></div>
<div class="line">  flags |= <a class="code hl_define" href="group__control-flags.html#ga902a8e77ba34f70e7cfae2aa5c1f7c8f">MSF_PNAMERANGE</a>;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* Set flag to unpack data if printing samples */</span></div>
<div class="line">  <span class="keywordflow">if</span> (printdata)</div>
<div class="line">    flags |= <a class="code hl_define" href="group__control-flags.html#ga95033e92e20f803ae8e3daebca1a2b5b">MSF_UNPACKDATA</a>;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* Enable accumulation of up to 10 error and warning messages */</span></div>
<div class="line">  <a class="code hl_function" href="group__logging.html#ga6efb16d950205d060217beb66379390e">ms_rloginit</a> (NULL, NULL, NULL, NULL, 10);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* Loop over the input file record by record */</span></div>
<div class="line">  <span class="keywordflow">while</span> ((retcode = <a class="code hl_function" href="group__io-functions.html#ga120eaddf0e86963ad6764899b3783cad">ms3_readmsr</a> (&amp;msr, inputfile, NULL, NULL,</div>
<div class="line">                                 flags, verbose)) == <a class="code hl_define" href="group__return-values.html#ga91727033ca93e4d2b47ecb80243b054d">MS_NOERROR</a>)</div>
<div class="line">  {</div>
<div class="line">    totalrecs++;</div>
<div class="line">    totalsamps += msr-&gt;<a class="code hl_variable" href="group__miniseed-record.html#a85d0d5f365d50df0490d944dffdb3853">samplecnt</a>;</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_function" href="group__miniseed-record.html#gaad6b4c5c5194d338f9d89dfe84b44bd9">msr3_print</a> (msr, ppackets);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Print data samples */</span></div>
<div class="line">    <span class="keywordflow">if</span> (printdata &amp;&amp; msr-&gt;<a class="code hl_variable" href="group__miniseed-record.html#a7871a3c78d7ecb7c30c6526aa1fd9718">numsamples</a> &gt; 0)</div>
<div class="line">    {</div>
<div class="line">      <span class="keywordtype">int</span> line, col, cnt, samplesize;</div>
<div class="line">      <span class="keywordtype">int</span> lines = (msr-&gt;<a class="code hl_variable" href="group__miniseed-record.html#a7871a3c78d7ecb7c30c6526aa1fd9718">numsamples</a> / 6) + 1;</div>
<div class="line">      <span class="keywordtype">void</span> *sptr;</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">if</span> ((samplesize = <a class="code hl_function" href="group__utility-functions.html#ga7595a7a94a4394418106d69b96e318f2">ms_samplesize</a> (msr-&gt;<a class="code hl_variable" href="group__miniseed-record.html#a866a8640500756bc031ef7897fc1eeb2">sampletype</a>)) == 0)</div>
<div class="line">      {</div>
<div class="line">        <a class="code hl_define" href="group__logging.html#ga2d51fa9deb29995ef93287db5e7b11c4">ms_log</a> (2, <span class="stringliteral">&quot;Unrecognized sample type: &#39;%c&#39;\n&quot;</span>, msr-&gt;<a class="code hl_variable" href="group__miniseed-record.html#a866a8640500756bc031ef7897fc1eeb2">sampletype</a>);</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span> (cnt = 0, line = 0; line &lt; lines; line++)</div>
<div class="line">      {</div>
<div class="line">        <span class="keywordflow">for</span> (col = 0; col &lt; 6; col++)</div>
<div class="line">        {</div>
<div class="line">          <span class="keywordflow">if</span> (cnt &lt; msr-&gt;numsamples)</div>
<div class="line">          {</div>
<div class="line">            sptr = (<span class="keywordtype">char</span> *)msr-&gt;<a class="code hl_variable" href="group__miniseed-record.html#a1c3a46dfc681da1bf5199b48bf9c55d3">datasamples</a> + (cnt * samplesize);</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (msr-&gt;<a class="code hl_variable" href="group__miniseed-record.html#a866a8640500756bc031ef7897fc1eeb2">sampletype</a> == <span class="charliteral">&#39;i&#39;</span>)</div>
<div class="line">              <a class="code hl_define" href="group__logging.html#ga2d51fa9deb29995ef93287db5e7b11c4">ms_log</a> (0, <span class="stringliteral">&quot;%10d  &quot;</span>, *(int32_t *)sptr);</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (msr-&gt;<a class="code hl_variable" href="group__miniseed-record.html#a866a8640500756bc031ef7897fc1eeb2">sampletype</a> == <span class="charliteral">&#39;f&#39;</span>)</div>
<div class="line">              <a class="code hl_define" href="group__logging.html#ga2d51fa9deb29995ef93287db5e7b11c4">ms_log</a> (0, <span class="stringliteral">&quot;%10.8g  &quot;</span>, *(<span class="keywordtype">float</span> *)sptr);</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (msr-&gt;<a class="code hl_variable" href="group__miniseed-record.html#a866a8640500756bc031ef7897fc1eeb2">sampletype</a> == <span class="charliteral">&#39;d&#39;</span>)</div>
<div class="line">              <a class="code hl_define" href="group__logging.html#ga2d51fa9deb29995ef93287db5e7b11c4">ms_log</a> (0, <span class="stringliteral">&quot;%10.10g  &quot;</span>, *(<span class="keywordtype">double</span> *)sptr);</div>
<div class="line"> </div>
<div class="line">            cnt++;</div>
<div class="line">          }</div>
<div class="line">        }</div>
<div class="line">        <a class="code hl_define" href="group__logging.html#ga2d51fa9deb29995ef93287db5e7b11c4">ms_log</a> (0, <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* If only printing the first 6 samples break out here */</span></div>
<div class="line">        <span class="keywordflow">if</span> (printdata == 1)</div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (retcode != <a class="code hl_define" href="group__return-values.html#gaaa6856cc106d8dcd273bdaa7a48082d0">MS_ENDOFFILE</a>)</div>
<div class="line">    <a class="code hl_function" href="group__logging.html#gaad1e7c2c3a4e65a313bf9009b3461378">ms_rlog_emit</a> (NULL, 0, verbose);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* Make sure everything is cleaned up */</span></div>
<div class="line">  <a class="code hl_function" href="group__io-functions.html#ga120eaddf0e86963ad6764899b3783cad">ms3_readmsr</a> (&amp;msr, NULL, NULL, NULL, 0, 0);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (basicsum)</div>
<div class="line">    <a class="code hl_define" href="group__logging.html#ga2d51fa9deb29995ef93287db5e7b11c4">ms_log</a> (1, <span class="stringliteral">&quot;Records: %&quot;</span> PRId64 <span class="stringliteral">&quot;, Samples: %&quot;</span> PRId64 <span class="stringliteral">&quot;\n&quot;</span>,</div>
<div class="line">            totalrecs, totalsamps);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">} <span class="comment">/* End of main() */</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/***************************************************************************</span></div>
<div class="line"><span class="comment"> * parameter_proc():</span></div>
<div class="line"><span class="comment"> * Process the command line arguments.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Returns 0 on success, and -1 on failure</span></div>
<div class="line"><span class="comment"> ***************************************************************************/</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">parameter_proc (<span class="keywordtype">int</span> argcount, <span class="keywordtype">char</span> **argvec)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">int</span> optind;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* Process all command line arguments */</span></div>
<div class="line">  <span class="keywordflow">for</span> (optind = 1; optind &lt; argcount; optind++)</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordflow">if</span> (strcmp (argvec[optind], <span class="stringliteral">&quot;-V&quot;</span>) == 0)</div>
<div class="line">    {</div>
<div class="line">      <a class="code hl_define" href="group__logging.html#ga2d51fa9deb29995ef93287db5e7b11c4">ms_log</a> (1, <span class="stringliteral">&quot;%s version: %s\n&quot;</span>, PACKAGE, VERSION);</div>
<div class="line">      exit (0);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp (argvec[optind], <span class="stringliteral">&quot;-h&quot;</span>) == 0)</div>
<div class="line">    {</div>
<div class="line">      usage ();</div>
<div class="line">      exit (0);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strncmp (argvec[optind], <span class="stringliteral">&quot;-v&quot;</span>, 2) == 0)</div>
<div class="line">    {</div>
<div class="line">      verbose += strspn (&amp;argvec[optind][1], <span class="stringliteral">&quot;v&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strncmp (argvec[optind], <span class="stringliteral">&quot;-p&quot;</span>, 2) == 0)</div>
<div class="line">    {</div>
<div class="line">      ppackets += strspn (&amp;argvec[optind][1], <span class="stringliteral">&quot;p&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strncmp (argvec[optind], <span class="stringliteral">&quot;-d&quot;</span>, 2) == 0)</div>
<div class="line">    {</div>
<div class="line">      printdata = 1;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strncmp (argvec[optind], <span class="stringliteral">&quot;-D&quot;</span>, 2) == 0)</div>
<div class="line">    {</div>
<div class="line">      printdata = 2;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp (argvec[optind], <span class="stringliteral">&quot;-s&quot;</span>) == 0)</div>
<div class="line">    {</div>
<div class="line">      basicsum = 1;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strncmp (argvec[optind], <span class="stringliteral">&quot;-&quot;</span>, 1) == 0 &amp;&amp;</div>
<div class="line">             strlen (argvec[optind]) &gt; 1)</div>
<div class="line">    {</div>
<div class="line">      <a class="code hl_define" href="group__logging.html#ga2d51fa9deb29995ef93287db5e7b11c4">ms_log</a> (2, <span class="stringliteral">&quot;Unknown option: %s\n&quot;</span>, argvec[optind]);</div>
<div class="line">      exit (1);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (inputfile == NULL)</div>
<div class="line">    {</div>
<div class="line">      inputfile = argvec[optind];</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line">      <a class="code hl_define" href="group__logging.html#ga2d51fa9deb29995ef93287db5e7b11c4">ms_log</a> (2, <span class="stringliteral">&quot;Unknown option: %s\n&quot;</span>, argvec[optind]);</div>
<div class="line">      exit (1);</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* Make sure an input file was specified */</span></div>
<div class="line">  <span class="keywordflow">if</span> (!inputfile)</div>
<div class="line">  {</div>
<div class="line">    <a class="code hl_define" href="group__logging.html#ga2d51fa9deb29995ef93287db5e7b11c4">ms_log</a> (2, <span class="stringliteral">&quot;No input file was specified\n\n&quot;</span>);</div>
<div class="line">    <a class="code hl_define" href="group__logging.html#ga2d51fa9deb29995ef93287db5e7b11c4">ms_log</a> (1, <span class="stringliteral">&quot;%s version %s\n\n&quot;</span>, PACKAGE, VERSION);</div>
<div class="line">    <a class="code hl_define" href="group__logging.html#ga2d51fa9deb29995ef93287db5e7b11c4">ms_log</a> (1, <span class="stringliteral">&quot;Try %s -h for usage\n&quot;</span>, PACKAGE);</div>
<div class="line">    exit (1);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* Add program name and version to User-Agent for URL-based requests */</span></div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code hl_function" href="group__io-functions.html#gaae2aee8ed2ea3bce6aa164e6c653c5c7">libmseed_url_support</a>() &amp;&amp; <a class="code hl_function" href="group__io-functions.html#gafcc98efb81d4f4adb24c9b07bd094e61">ms3_url_useragent</a>(PACKAGE, VERSION))</div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* Report the program version */</span></div>
<div class="line">  <span class="keywordflow">if</span> (verbose)</div>
<div class="line">    <a class="code hl_define" href="group__logging.html#ga2d51fa9deb29995ef93287db5e7b11c4">ms_log</a> (1, <span class="stringliteral">&quot;%s version: %s\n&quot;</span>, PACKAGE, VERSION);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">} <span class="comment">/* End of parameter_proc() */</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/***************************************************************************</span></div>
<div class="line"><span class="comment"> * usage():</span></div>
<div class="line"><span class="comment"> * Print the usage message and exit.</span></div>
<div class="line"><span class="comment"> ***************************************************************************/</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">usage (<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">  fprintf (stderr, <span class="stringliteral">&quot;%s version: %s\n\n&quot;</span>, PACKAGE, VERSION);</div>
<div class="line">  fprintf (stderr, <span class="stringliteral">&quot;Usage: %s [options] file\n\n&quot;</span>, PACKAGE);</div>
<div class="line">  fprintf (stderr,</div>
<div class="line">           <span class="stringliteral">&quot; ## Options ##\n&quot;</span></div>
<div class="line">           <span class="stringliteral">&quot; -V             Report program version\n&quot;</span></div>
<div class="line">           <span class="stringliteral">&quot; -h             Show this usage message\n&quot;</span></div>
<div class="line">           <span class="stringliteral">&quot; -v             Be more verbose, multiple flags can be used\n&quot;</span></div>
<div class="line">           <span class="stringliteral">&quot; -p             Print details of header, multiple flags can be used\n&quot;</span></div>
<div class="line">           <span class="stringliteral">&quot; -d             Print first 6 sample values\n&quot;</span></div>
<div class="line">           <span class="stringliteral">&quot; -D             Print all sample values\n&quot;</span></div>
<div class="line">           <span class="stringliteral">&quot; -s             Print a basic summary after processing a file\n&quot;</span></div>
<div class="line">           <span class="stringliteral">&quot;\n&quot;</span></div>
<div class="line">           <span class="stringliteral">&quot; file           File of miniSEED records\n&quot;</span></div>
<div class="line">           <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line">} <span class="comment">/* End of usage() */</span></div>
<div class="ttc" id="agroup__control-flags_html_ga902a8e77ba34f70e7cfae2aa5c1f7c8f"><div class="ttname"><a href="group__control-flags.html#ga902a8e77ba34f70e7cfae2aa5c1f7c8f">MSF_PNAMERANGE</a></div><div class="ttdeci">#define MSF_PNAMERANGE</div><div class="ttdoc">[Parsing] Parse and utilize byte range from path name suffix</div><div class="ttdef"><b>Definition:</b> libmseed.h:1347</div></div>
<div class="ttc" id="agroup__control-flags_html_ga95033e92e20f803ae8e3daebca1a2b5b"><div class="ttname"><a href="group__control-flags.html#ga95033e92e20f803ae8e3daebca1a2b5b">MSF_UNPACKDATA</a></div><div class="ttdeci">#define MSF_UNPACKDATA</div><div class="ttdoc">[Parsing] Unpack data samples</div><div class="ttdef"><b>Definition:</b> libmseed.h:1344</div></div>
<div class="ttc" id="agroup__control-flags_html_gab06edaad68767eb4f5603d3fcb3eeb13"><div class="ttname"><a href="group__control-flags.html#gab06edaad68767eb4f5603d3fcb3eeb13">MSF_VALIDATECRC</a></div><div class="ttdeci">#define MSF_VALIDATECRC</div><div class="ttdoc">[Parsing] Validate CRC (if version 3)</div><div class="ttdef"><b>Definition:</b> libmseed.h:1346</div></div>
<div class="ttc" id="agroup__io-functions_html_ga120eaddf0e86963ad6764899b3783cad"><div class="ttname"><a href="group__io-functions.html#ga120eaddf0e86963ad6764899b3783cad">ms3_readmsr</a></div><div class="ttdeci">int ms3_readmsr(MS3Record **ppmsr, const char *mspath, int64_t *fpos, int8_t *last, uint32_t flags, int8_t verbose)</div><div class="ttdoc">Read miniSEED records from a file or URL.</div><div class="ttdef"><b>Definition:</b> fileutils.c:72</div></div>
<div class="ttc" id="agroup__io-functions_html_gaae2aee8ed2ea3bce6aa164e6c653c5c7"><div class="ttname"><a href="group__io-functions.html#gaae2aee8ed2ea3bce6aa164e6c653c5c7">libmseed_url_support</a></div><div class="ttdeci">int libmseed_url_support(void)</div><div class="ttdoc">Run-time test for URL support in libmseed.</div><div class="ttdef"><b>Definition:</b> fileutils.c:49</div></div>
<div class="ttc" id="agroup__io-functions_html_gafcc98efb81d4f4adb24c9b07bd094e61"><div class="ttname"><a href="group__io-functions.html#gafcc98efb81d4f4adb24c9b07bd094e61">ms3_url_useragent</a></div><div class="ttdeci">int ms3_url_useragent(const char *program, const char *version)</div><div class="ttdoc">Set User-Agent header for URL-based requests.</div><div class="ttdef"><b>Definition:</b> fileutils.c:759</div></div>
<div class="ttc" id="agroup__logging_html_ga2d51fa9deb29995ef93287db5e7b11c4"><div class="ttname"><a href="group__logging.html#ga2d51fa9deb29995ef93287db5e7b11c4">ms_log</a></div><div class="ttdeci">#define ms_log(level,...)</div><div class="ttdoc">Wrapper for ms_rlog(), call as ms_log (level, format, ...)</div><div class="ttdef"><b>Definition:</b> libmseed.h:1086</div></div>
<div class="ttc" id="agroup__logging_html_ga6efb16d950205d060217beb66379390e"><div class="ttname"><a href="group__logging.html#ga6efb16d950205d060217beb66379390e">ms_rloginit</a></div><div class="ttdeci">void ms_rloginit(void(*log_print)(const char *), const char *logprefix, void(*diag_print)(const char *), const char *errprefix, int maxmessages)</div><div class="ttdoc">Initialize the global logging parameters.</div><div class="ttdef"><b>Definition:</b> logging.c:92</div></div>
<div class="ttc" id="agroup__logging_html_gaad1e7c2c3a4e65a313bf9009b3461378"><div class="ttname"><a href="group__logging.html#gaad1e7c2c3a4e65a313bf9009b3461378">ms_rlog_emit</a></div><div class="ttdeci">int ms_rlog_emit(MSLogParam *logp, int count, int context)</div><div class="ttdoc">Emit, aka send to print functions, messages from log registry.</div><div class="ttdef"><b>Definition:</b> logging.c:573</div></div>
<div class="ttc" id="agroup__miniseed-record_html_a1c3a46dfc681da1bf5199b48bf9c55d3"><div class="ttname"><a href="group__miniseed-record.html#a1c3a46dfc681da1bf5199b48bf9c55d3">MS3Record::datasamples</a></div><div class="ttdeci">void * datasamples</div><div class="ttdoc">Data samples, numsamples of type sampletype.</div><div class="ttdef"><b>Definition:</b> libmseed.h:343</div></div>
<div class="ttc" id="agroup__miniseed-record_html_a7871a3c78d7ecb7c30c6526aa1fd9718"><div class="ttname"><a href="group__miniseed-record.html#a7871a3c78d7ecb7c30c6526aa1fd9718">MS3Record::numsamples</a></div><div class="ttdeci">int64_t numsamples</div><div class="ttdoc">Number of data samples in datasamples.</div><div class="ttdef"><b>Definition:</b> libmseed.h:345</div></div>
<div class="ttc" id="agroup__miniseed-record_html_a85d0d5f365d50df0490d944dffdb3853"><div class="ttname"><a href="group__miniseed-record.html#a85d0d5f365d50df0490d944dffdb3853">MS3Record::samplecnt</a></div><div class="ttdeci">int64_t samplecnt</div><div class="ttdoc">Number of samples in record.</div><div class="ttdef"><b>Definition:</b> libmseed.h:336</div></div>
<div class="ttc" id="agroup__miniseed-record_html_a866a8640500756bc031ef7897fc1eeb2"><div class="ttname"><a href="group__miniseed-record.html#a866a8640500756bc031ef7897fc1eeb2">MS3Record::sampletype</a></div><div class="ttdeci">char sampletype</div><div class="ttdoc">Sample type code: a, i, f, d Sample Types.</div><div class="ttdef"><b>Definition:</b> libmseed.h:346</div></div>
<div class="ttc" id="agroup__miniseed-record_html_gaad6b4c5c5194d338f9d89dfe84b44bd9"><div class="ttname"><a href="group__miniseed-record.html#gaad6b4c5c5194d338f9d89dfe84b44bd9">msr3_print</a></div><div class="ttdeci">void msr3_print(MS3Record *msr, int8_t details)</div><div class="ttdoc">Print header values of an MS3Record.</div><div class="ttdef"><b>Definition:</b> msrutils.c:238</div></div>
<div class="ttc" id="agroup__miniseed-record_html_struct_m_s3_record"><div class="ttname"><a href="group__miniseed-record.html#struct_m_s3_record">MS3Record</a></div><div class="ttdoc">miniSEED record container</div><div class="ttdef"><b>Definition:</b> libmseed.h:323</div></div>
<div class="ttc" id="agroup__return-values_html_ga91727033ca93e4d2b47ecb80243b054d"><div class="ttname"><a href="group__return-values.html#ga91727033ca93e4d2b47ecb80243b054d">MS_NOERROR</a></div><div class="ttdeci">#define MS_NOERROR</div><div class="ttdoc">No error.</div><div class="ttdef"><b>Definition:</b> libmseed.h:1327</div></div>
<div class="ttc" id="agroup__return-values_html_gaaa6856cc106d8dcd273bdaa7a48082d0"><div class="ttname"><a href="group__return-values.html#gaaa6856cc106d8dcd273bdaa7a48082d0">MS_ENDOFFILE</a></div><div class="ttdeci">#define MS_ENDOFFILE</div><div class="ttdoc">End of file reached return value.</div><div class="ttdef"><b>Definition:</b> libmseed.h:1326</div></div>
<div class="ttc" id="agroup__utility-functions_html_ga7595a7a94a4394418106d69b96e318f2"><div class="ttname"><a href="group__utility-functions.html#ga7595a7a94a4394418106d69b96e318f2">ms_samplesize</a></div><div class="ttdeci">uint8_t ms_samplesize(const char sampletype)</div><div class="ttdoc">Determine data sample size for each type.</div><div class="ttdef"><b>Definition:</b> lookup.c:39</div></div>
<div class="ttc" id="alibmseed_8h_html"><div class="ttname"><a href="libmseed_8h.html">libmseed.h</a></div></div>
</div><!-- fragment --><h1><a class="anchor" id="example-lm_read_selection"></a>
Reading with selections</h1>
<p >Read miniSEED with <a class="el" href="group__data-selections.html">Data Selections</a> used to limit what is read. Additionally, this program reads data into a <a class="el" href="group__trace-list.html">Trace List</a> and illustrates traversing the entries.</p>
<div class="fragment"><div class="line"><span class="comment">/***************************************************************************</span></div>
<div class="line"><span class="comment"> * A program for reading miniSEED using data selections to limit which</span></div>
<div class="line"><span class="comment"> * data is read.  This program also illustrates traversing a trace</span></div>
<div class="line"><span class="comment"> * list.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * This file is part of the miniSEED Library.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Copyright (c) 2020 Chad Trabant, IRIS Data Management Center</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span></div>
<div class="line"><span class="comment"> * you may not use this file except in compliance with the License.</span></div>
<div class="line"><span class="comment"> * You may obtain a copy of the License at</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *   http://www.apache.org/licenses/LICENSE-2.0</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Unless required by applicable law or agreed to in writing, software</span></div>
<div class="line"><span class="comment"> * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></div>
<div class="line"><span class="comment"> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></div>
<div class="line"><span class="comment"> * See the License for the specific language governing permissions and</span></div>
<div class="line"><span class="comment"> * limitations under the License.</span></div>
<div class="line"><span class="comment"> ***************************************************************************/</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sys/stat.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;errno.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="libmseed_8h.html">libmseed.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span></div>
<div class="line">main (<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)</div>
<div class="line">{</div>
<div class="line">  <a class="code hl_struct" href="group__data-selections.html#struct_m_s3_selections">MS3Selections</a> *selections = NULL;</div>
<div class="line">  <a class="code hl_struct" href="group__trace-list.html#struct_m_s3_trace_list">MS3TraceList</a> *mstl = NULL;</div>
<div class="line">  <a class="code hl_struct" href="group__trace-list.html#struct_m_s3_trace_i_d">MS3TraceID</a> *tid = NULL;</div>
<div class="line">  <a class="code hl_struct" href="group__trace-list.html#struct_m_s3_trace_seg">MS3TraceSeg</a> *seg = NULL;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">char</span> *mseedfile = NULL;</div>
<div class="line">  <span class="keywordtype">char</span> *selectionfile = NULL;</div>
<div class="line">  <span class="keywordtype">char</span> starttimestr[30];</div>
<div class="line">  <span class="keywordtype">char</span> endtimestr[30];</div>
<div class="line">  uint32_t flags = 0;</div>
<div class="line">  int8_t verbose = 0;</div>
<div class="line">  <span class="keywordtype">int</span> rv;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (argc != 3)</div>
<div class="line">  {</div>
<div class="line">    <a class="code hl_define" href="group__logging.html#ga2d51fa9deb29995ef93287db5e7b11c4">ms_log</a> (2, <span class="stringliteral">&quot;Usage: %s &lt;mseedfile&gt; &lt;selectionfile&gt;\n&quot;</span>,argv[0]);</div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  mseedfile = argv[1];</div>
<div class="line">  selectionfile = argv[2];</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* Read data selections from specified file */</span></div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code hl_function" href="group__data-selections.html#gaf8aa9de2cbbc18bc96fe3c4f0dfcb92d">ms3_readselectionsfile</a> (&amp;selections, selectionfile) &lt; 0)</div>
<div class="line">  {</div>
<div class="line">    <a class="code hl_define" href="group__logging.html#ga2d51fa9deb29995ef93287db5e7b11c4">ms_log</a> (2, <span class="stringliteral">&quot;Cannot read data selection file\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* Set bit flags to validate CRC and unpack data samples */</span></div>
<div class="line">  flags |= <a class="code hl_define" href="group__control-flags.html#gab06edaad68767eb4f5603d3fcb3eeb13">MSF_VALIDATECRC</a>;</div>
<div class="line">  flags |= <a class="code hl_define" href="group__control-flags.html#ga95033e92e20f803ae8e3daebca1a2b5b">MSF_UNPACKDATA</a>;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* Read all miniSEED into a trace list, limiting to selections */</span></div>
<div class="line">  rv = <a class="code hl_function" href="group__io-functions.html#ga4f447cc856a590286bf01eda71eaa74b">ms3_readtracelist_selection</a> (&amp;mstl, mseedfile, NULL,</div>
<div class="line">                                    selections, 0, flags, verbose);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (rv != <a class="code hl_define" href="group__return-values.html#ga91727033ca93e4d2b47ecb80243b054d">MS_NOERROR</a>)</div>
<div class="line">  {</div>
<div class="line">    <a class="code hl_define" href="group__logging.html#ga2d51fa9deb29995ef93287db5e7b11c4">ms_log</a> (2, <span class="stringliteral">&quot;Cannot read miniSEED from file: %s\n&quot;</span>, <a class="code hl_function" href="group__utility-functions.html#gac7d8c8a631b2d333da3246610b75f079">ms_errorstr</a>(rv));</div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* Traverse trace list structures and print summary information */</span></div>
<div class="line">  tid = mstl-&gt;<a class="code hl_variable" href="group__trace-list.html#a4dddb7dd95226889820e4e8046c8bcb8">traces</a>;</div>
<div class="line">  <span class="keywordflow">while</span> (tid)</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordflow">if</span> (!<a class="code hl_function" href="group__time-related.html#gafc71e63c89345baaba450780d1066235">ms_nstime2timestr</a> (tid-&gt;<a class="code hl_variable" href="group__trace-list.html#a537e76409176bd8fca77a71e73b825fb">earliest</a>, starttimestr, SEEDORDINAL, NANO_MICRO_NONE) ||</div>
<div class="line">        !<a class="code hl_function" href="group__time-related.html#gafc71e63c89345baaba450780d1066235">ms_nstime2timestr</a> (tid-&gt;<a class="code hl_variable" href="group__trace-list.html#a3464b9217cd83f1c8a1527ac2384ff63">latest</a>, endtimestr, SEEDORDINAL, NANO_MICRO_NONE))</div>
<div class="line">    {</div>
<div class="line">      <a class="code hl_define" href="group__logging.html#ga2d51fa9deb29995ef93287db5e7b11c4">ms_log</a> (2, <span class="stringliteral">&quot;Cannot create time strings\n&quot;</span>);</div>
<div class="line">      starttimestr[0] = endtimestr[0] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_define" href="group__logging.html#ga2d51fa9deb29995ef93287db5e7b11c4">ms_log</a> (0, <span class="stringliteral">&quot;TraceID for %s (%d), earliest: %s, latest: %s, segments: %u\n&quot;</span>,</div>
<div class="line">            tid-&gt;<a class="code hl_variable" href="group__trace-list.html#aaa4e9d9d9fb4c2bf4f93472500744c52">sid</a>, tid-&gt;<a class="code hl_variable" href="group__trace-list.html#a49a7a751c8f59f769ec3b6e29e8aacfd">pubversion</a>, starttimestr, endtimestr, tid-&gt;<a class="code hl_variable" href="group__trace-list.html#afdbdeb4baba7b1b2bbdb92738344b70c">numsegments</a>);</div>
<div class="line"> </div>
<div class="line">    seg = tid-&gt;<a class="code hl_variable" href="group__trace-list.html#a2c57e9aa2e2b922b57df9ea8031aebde">first</a>;</div>
<div class="line">    <span class="keywordflow">while</span> (seg)</div>
<div class="line">    {</div>
<div class="line">      <span class="keywordflow">if</span> (!<a class="code hl_function" href="group__time-related.html#gafc71e63c89345baaba450780d1066235">ms_nstime2timestr</a> (seg-&gt;<a class="code hl_variable" href="group__trace-list.html#afa4b2623a8ffb336a9d9d9a9773c0dc0">starttime</a>, starttimestr, SEEDORDINAL, NANO_MICRO_NONE) ||</div>
<div class="line">          !<a class="code hl_function" href="group__time-related.html#gafc71e63c89345baaba450780d1066235">ms_nstime2timestr</a> (seg-&gt;<a class="code hl_variable" href="group__trace-list.html#a2c33217da025db4c975c4013629d53eb">endtime</a>, endtimestr, SEEDORDINAL, NANO_MICRO_NONE))</div>
<div class="line">      {</div>
<div class="line">        <a class="code hl_define" href="group__logging.html#ga2d51fa9deb29995ef93287db5e7b11c4">ms_log</a> (2, <span class="stringliteral">&quot;Cannot create time strings\n&quot;</span>);</div>
<div class="line">        starttimestr[0] = endtimestr[0] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">      <a class="code hl_define" href="group__logging.html#ga2d51fa9deb29995ef93287db5e7b11c4">ms_log</a> (0, <span class="stringliteral">&quot;  Segment %s - %s, samples: %&quot;</span> PRId64 <span class="stringliteral">&quot;, sample rate: %g, sample type: %c\n&quot;</span>,</div>
<div class="line">              starttimestr, endtimestr, seg-&gt;<a class="code hl_variable" href="group__trace-list.html#a04a949bf1a75ed3008e22243922fe53c">numsamples</a>, seg-&gt;<a class="code hl_variable" href="group__trace-list.html#acb10e4263b0aeaab66232c35d8c7d5ac">samprate</a>,</div>
<div class="line">              (seg-&gt;<a class="code hl_variable" href="group__trace-list.html#a9addbbe3f6cbb7f742b8def029cde74e">sampletype</a>) ? seg-&gt;<a class="code hl_variable" href="group__trace-list.html#a9addbbe3f6cbb7f742b8def029cde74e">sampletype</a> : <span class="charliteral">&#39; &#39;</span>);</div>
<div class="line"> </div>
<div class="line">      seg = seg-&gt;<a class="code hl_variable" href="group__trace-list.html#ad5acfe831d046c60102414e333cb46a3">next</a>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    tid = tid-&gt;<a class="code hl_variable" href="group__trace-list.html#a7010e1a21bb73ccf12c5bbd783bfc9da">next</a>;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* Make sure everything is cleaned up */</span></div>
<div class="line">  <span class="keywordflow">if</span> (mstl)</div>
<div class="line">    <a class="code hl_function" href="group__trace-list.html#ga2a436ab4eb7cd653e52e6760c2f51f20">mstl3_free</a> (&amp;mstl, 0);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (selections)</div>
<div class="line">    <a class="code hl_function" href="group__data-selections.html#ga63f765d5d879a6e9c065e56c47a9d053">ms3_freeselections</a> (selections);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="agroup__data-selections_html_ga63f765d5d879a6e9c065e56c47a9d053"><div class="ttname"><a href="group__data-selections.html#ga63f765d5d879a6e9c065e56c47a9d053">ms3_freeselections</a></div><div class="ttdeci">void ms3_freeselections(MS3Selections *selections)</div><div class="ttdoc">Free all memory associated with a MS3Selections.</div><div class="ttdef"><b>Definition:</b> selection.c:660</div></div>
<div class="ttc" id="agroup__data-selections_html_gaf8aa9de2cbbc18bc96fe3c4f0dfcb92d"><div class="ttname"><a href="group__data-selections.html#gaf8aa9de2cbbc18bc96fe3c4f0dfcb92d">ms3_readselectionsfile</a></div><div class="ttdeci">int ms3_readselectionsfile(MS3Selections **ppselections, char *filename)</div><div class="ttdoc">Read data selections from a file.</div><div class="ttdef"><b>Definition:</b> selection.c:424</div></div>
<div class="ttc" id="agroup__data-selections_html_struct_m_s3_selections"><div class="ttname"><a href="group__data-selections.html#struct_m_s3_selections">MS3Selections</a></div><div class="ttdoc">Data selection structure definition containers.</div><div class="ttdef"><b>Definition:</b> libmseed.h:409</div></div>
<div class="ttc" id="agroup__io-functions_html_ga4f447cc856a590286bf01eda71eaa74b"><div class="ttname"><a href="group__io-functions.html#ga4f447cc856a590286bf01eda71eaa74b">ms3_readtracelist_selection</a></div><div class="ttdeci">int ms3_readtracelist_selection(MS3TraceList **ppmstl, const char *mspath, MS3Tolerance *tolerance, MS3Selections *selections, int8_t splitversion, uint32_t flags, int8_t verbose)</div><div class="ttdoc">Read miniSEED from a file into a trace list, with selection filtering.</div><div class="ttdef"><b>Definition:</b> fileutils.c:666</div></div>
<div class="ttc" id="agroup__time-related_html_gafc71e63c89345baaba450780d1066235"><div class="ttname"><a href="group__time-related.html#gafc71e63c89345baaba450780d1066235">ms_nstime2timestr</a></div><div class="ttdeci">char * ms_nstime2timestr(nstime_t nstime, char *timestr, ms_timeformat_t timeformat, ms_subseconds_t subsecond)</div><div class="ttdoc">Convert an nstime_t to a time string.</div><div class="ttdef"><b>Definition:</b> genutils.c:895</div></div>
<div class="ttc" id="agroup__trace-list_html_a04a949bf1a75ed3008e22243922fe53c"><div class="ttname"><a href="group__trace-list.html#a04a949bf1a75ed3008e22243922fe53c">MS3TraceSeg::numsamples</a></div><div class="ttdeci">int64_t numsamples</div><div class="ttdoc">Number of data samples in datasamples.</div><div class="ttdef"><b>Definition:</b> libmseed.h:518</div></div>
<div class="ttc" id="agroup__trace-list_html_a2c33217da025db4c975c4013629d53eb"><div class="ttname"><a href="group__trace-list.html#a2c33217da025db4c975c4013629d53eb">MS3TraceSeg::endtime</a></div><div class="ttdeci">nstime_t endtime</div><div class="ttdoc">Time of last sample.</div><div class="ttdef"><b>Definition:</b> libmseed.h:513</div></div>
<div class="ttc" id="agroup__trace-list_html_a2c57e9aa2e2b922b57df9ea8031aebde"><div class="ttname"><a href="group__trace-list.html#a2c57e9aa2e2b922b57df9ea8031aebde">MS3TraceID::first</a></div><div class="ttdeci">struct MS3TraceSeg * first</div><div class="ttdoc">Pointer to first of list of segments.</div><div class="ttdef"><b>Definition:</b> libmseed.h:534</div></div>
<div class="ttc" id="agroup__trace-list_html_a3464b9217cd83f1c8a1527ac2384ff63"><div class="ttname"><a href="group__trace-list.html#a3464b9217cd83f1c8a1527ac2384ff63">MS3TraceID::latest</a></div><div class="ttdeci">nstime_t latest</div><div class="ttdoc">Time of latest sample.</div><div class="ttdef"><b>Definition:</b> libmseed.h:531</div></div>
<div class="ttc" id="agroup__trace-list_html_a49a7a751c8f59f769ec3b6e29e8aacfd"><div class="ttname"><a href="group__trace-list.html#a49a7a751c8f59f769ec3b6e29e8aacfd">MS3TraceID::pubversion</a></div><div class="ttdeci">uint8_t pubversion</div><div class="ttdoc">Largest contributing publication version.</div><div class="ttdef"><b>Definition:</b> libmseed.h:529</div></div>
<div class="ttc" id="agroup__trace-list_html_a4dddb7dd95226889820e4e8046c8bcb8"><div class="ttname"><a href="group__trace-list.html#a4dddb7dd95226889820e4e8046c8bcb8">MS3TraceList::traces</a></div><div class="ttdeci">struct MS3TraceID * traces</div><div class="ttdoc">Pointer to list of traces.</div><div class="ttdef"><b>Definition:</b> libmseed.h:542</div></div>
<div class="ttc" id="agroup__trace-list_html_a537e76409176bd8fca77a71e73b825fb"><div class="ttname"><a href="group__trace-list.html#a537e76409176bd8fca77a71e73b825fb">MS3TraceID::earliest</a></div><div class="ttdeci">nstime_t earliest</div><div class="ttdoc">Time of earliest sample.</div><div class="ttdef"><b>Definition:</b> libmseed.h:530</div></div>
<div class="ttc" id="agroup__trace-list_html_a7010e1a21bb73ccf12c5bbd783bfc9da"><div class="ttname"><a href="group__trace-list.html#a7010e1a21bb73ccf12c5bbd783bfc9da">MS3TraceID::next</a></div><div class="ttdeci">struct MS3TraceID * next</div><div class="ttdoc">Pointer to next trace ID, NULL if the last.</div><div class="ttdef"><b>Definition:</b> libmseed.h:536</div></div>
<div class="ttc" id="agroup__trace-list_html_a9addbbe3f6cbb7f742b8def029cde74e"><div class="ttname"><a href="group__trace-list.html#a9addbbe3f6cbb7f742b8def029cde74e">MS3TraceSeg::sampletype</a></div><div class="ttdeci">char sampletype</div><div class="ttdoc">Sample type code, see Sample Types.</div><div class="ttdef"><b>Definition:</b> libmseed.h:519</div></div>
<div class="ttc" id="agroup__trace-list_html_aaa4e9d9d9fb4c2bf4f93472500744c52"><div class="ttname"><a href="group__trace-list.html#aaa4e9d9d9fb4c2bf4f93472500744c52">MS3TraceID::sid</a></div><div class="ttdeci">char sid[LM_SIDLEN]</div><div class="ttdoc">Source identifier as URN, max length LM_SIDLEN.</div><div class="ttdef"><b>Definition:</b> libmseed.h:528</div></div>
<div class="ttc" id="agroup__trace-list_html_acb10e4263b0aeaab66232c35d8c7d5ac"><div class="ttname"><a href="group__trace-list.html#acb10e4263b0aeaab66232c35d8c7d5ac">MS3TraceSeg::samprate</a></div><div class="ttdeci">double samprate</div><div class="ttdoc">Nominal sample rate (Hz)</div><div class="ttdef"><b>Definition:</b> libmseed.h:514</div></div>
<div class="ttc" id="agroup__trace-list_html_ad5acfe831d046c60102414e333cb46a3"><div class="ttname"><a href="group__trace-list.html#ad5acfe831d046c60102414e333cb46a3">MS3TraceSeg::next</a></div><div class="ttdeci">struct MS3TraceSeg * next</div><div class="ttdoc">Pointer to next segment, NULL if the last.</div><div class="ttdef"><b>Definition:</b> libmseed.h:523</div></div>
<div class="ttc" id="agroup__trace-list_html_afa4b2623a8ffb336a9d9d9a9773c0dc0"><div class="ttname"><a href="group__trace-list.html#afa4b2623a8ffb336a9d9d9a9773c0dc0">MS3TraceSeg::starttime</a></div><div class="ttdeci">nstime_t starttime</div><div class="ttdoc">Time of first sample.</div><div class="ttdef"><b>Definition:</b> libmseed.h:512</div></div>
<div class="ttc" id="agroup__trace-list_html_afdbdeb4baba7b1b2bbdb92738344b70c"><div class="ttname"><a href="group__trace-list.html#afdbdeb4baba7b1b2bbdb92738344b70c">MS3TraceID::numsegments</a></div><div class="ttdeci">uint32_t numsegments</div><div class="ttdoc">Number of segments for this ID.</div><div class="ttdef"><b>Definition:</b> libmseed.h:533</div></div>
<div class="ttc" id="agroup__trace-list_html_ga2a436ab4eb7cd653e52e6760c2f51f20"><div class="ttname"><a href="group__trace-list.html#ga2a436ab4eb7cd653e52e6760c2f51f20">mstl3_free</a></div><div class="ttdeci">void mstl3_free(MS3TraceList **ppmstl, int8_t freeprvtptr)</div><div class="ttdoc">Free all memory associated with a MS3TraceList.</div><div class="ttdef"><b>Definition:</b> tracelist.c:79</div></div>
<div class="ttc" id="agroup__trace-list_html_struct_m_s3_trace_i_d"><div class="ttname"><a href="group__trace-list.html#struct_m_s3_trace_i_d">MS3TraceID</a></div><div class="ttdoc">Container for a trace ID, linkable.</div><div class="ttdef"><b>Definition:</b> libmseed.h:527</div></div>
<div class="ttc" id="agroup__trace-list_html_struct_m_s3_trace_list"><div class="ttname"><a href="group__trace-list.html#struct_m_s3_trace_list">MS3TraceList</a></div><div class="ttdoc">Container for a collection of continuous trace segment, linkable.</div><div class="ttdef"><b>Definition:</b> libmseed.h:540</div></div>
<div class="ttc" id="agroup__trace-list_html_struct_m_s3_trace_seg"><div class="ttname"><a href="group__trace-list.html#struct_m_s3_trace_seg">MS3TraceSeg</a></div><div class="ttdoc">Container for a continuous trace segment, linkable.</div><div class="ttdef"><b>Definition:</b> libmseed.h:511</div></div>
<div class="ttc" id="agroup__utility-functions_html_gac7d8c8a631b2d333da3246610b75f079"><div class="ttname"><a href="group__utility-functions.html#gac7d8c8a631b2d333da3246610b75f079">ms_errorstr</a></div><div class="ttdeci">const char * ms_errorstr(int errorcode)</div><div class="ttdoc">Descriptive string for library Return codes.</div><div class="ttdef"><b>Definition:</b> lookup.c:204</div></div>
</div><!-- fragment --><h1><a class="anchor" id="example-lm_read_recordlist"></a>
Reading with record lists</h1>
<p >Read miniSEED a file in 2 passes:</p><ol type="1">
<li>Read the file and construct a <a class="el" href="group__trace-list.html">Trace List</a> without unpacking the data samples and constructing a <a class="el" href="group__record-list.html">Record List</a></li>
<li>Unpack the data samples for each segment individually.</li>
</ol>
<p >This pattern allows the caller to selectively unpack the data by segment if desired.</p>
<p >While this example unpacks the data into a buffer allocated by the library, the unpacking routine <a class="el" href="group__trace-list.html#ga61e3899b8390546f6d2a725d2a2e137a" title="Unpack data samples in a Record List associated with a MS3TraceList.">mstl3_unpack_recordlist()</a> also allows data samples to be placed directly into caller-specified memory buffers.</p>
<p >While this example uses <a class="el" href="group__io-functions.html#gadba1db9680c4e40ea9c680f3eb1b753e" title="Read miniSEED from a file into a trace list.">ms3_readtracelist()</a> for reading data from a file, the same functionality exists in <a class="el" href="group__trace-list.html#ga0fc8e37886c7b346929dcede76d686fc" title="Parse miniSEED from a buffer and populate a MS3TraceList.">mstl3_readbuffer()</a> for reading data from a memory buffer.</p>
<div class="fragment"><div class="line"><span class="comment">/***************************************************************************</span></div>
<div class="line"><span class="comment"> * A program for reading miniSEED into a trace list followed by</span></div>
<div class="line"><span class="comment"> * unpacking from an associated record list.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * This file is part of the miniSEED Library.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Copyright (c) 2020 Chad Trabant, IRIS Data Management Center</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span></div>
<div class="line"><span class="comment"> * you may not use this file except in compliance with the License.</span></div>
<div class="line"><span class="comment"> * You may obtain a copy of the License at</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *   http://www.apache.org/licenses/LICENSE-2.0</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Unless required by applicable law or agreed to in writing, software</span></div>
<div class="line"><span class="comment"> * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></div>
<div class="line"><span class="comment"> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></div>
<div class="line"><span class="comment"> * See the License for the specific language governing permissions and</span></div>
<div class="line"><span class="comment"> * limitations under the License.</span></div>
<div class="line"><span class="comment"> ***************************************************************************/</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sys/stat.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;limits.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;errno.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="libmseed_8h.html">libmseed.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span></div>
<div class="line">main (<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)</div>
<div class="line">{</div>
<div class="line">  <a class="code hl_struct" href="group__trace-list.html#struct_m_s3_trace_list">MS3TraceList</a> *mstl = NULL;</div>
<div class="line">  <a class="code hl_struct" href="group__trace-list.html#struct_m_s3_trace_i_d">MS3TraceID</a> *tid = NULL;</div>
<div class="line">  <a class="code hl_struct" href="group__trace-list.html#struct_m_s3_trace_seg">MS3TraceSeg</a> *seg = NULL;</div>
<div class="line">  <a class="code hl_struct" href="group__record-list.html#struct_m_s3_record_ptr">MS3RecordPtr</a> *recptr = NULL;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">char</span> *mseedfile = NULL;</div>
<div class="line">  <span class="keywordtype">char</span> starttimestr[30];</div>
<div class="line">  <span class="keywordtype">char</span> endtimestr[30];</div>
<div class="line">  <span class="keywordtype">char</span> bufferptrstr[30];</div>
<div class="line">  <span class="keywordtype">char</span> fileptrstr[30];</div>
<div class="line">  uint32_t flags = 0;</div>
<div class="line">  int8_t verbose = 0;</div>
<div class="line">  <span class="keywordtype">size_t</span> idx;</div>
<div class="line">  <span class="keywordtype">int</span> rv;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">char</span> printdata = 0;</div>
<div class="line">  int64_t unpacked;</div>
<div class="line">  uint8_t samplesize;</div>
<div class="line">  <span class="keywordtype">char</span> sampletype;</div>
<div class="line">  <span class="keywordtype">size_t</span> lineidx;</div>
<div class="line">  <span class="keywordtype">size_t</span> lines;</div>
<div class="line">  <span class="keywordtype">int</span> col;</div>
<div class="line">  <span class="keywordtype">void</span> *sptr;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (argc &lt; 2)</div>
<div class="line">  {</div>
<div class="line">    <a class="code hl_define" href="group__logging.html#ga2d51fa9deb29995ef93287db5e7b11c4">ms_log</a> (2, <span class="stringliteral">&quot;Usage: %s &lt;mseedfile&gt; [-v] [-d] [-D]\n&quot;</span>,argv[0]);</div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  mseedfile = argv[1];</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* Simplistic argument parsing */</span></div>
<div class="line">  <span class="keywordflow">for</span> (idx = 2; idx &lt; argc; idx++)</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordflow">if</span> (strncmp (argv[idx], <span class="stringliteral">&quot;-v&quot;</span>, 2) == 0)</div>
<div class="line">      verbose += strspn (&amp;argv[idx][1], <span class="stringliteral">&quot;v&quot;</span>);</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strncmp (argv[idx], <span class="stringliteral">&quot;-d&quot;</span>, 2) == 0)</div>
<div class="line">      printdata = <span class="charliteral">&#39;d&#39;</span>;</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strncmp (argv[idx], <span class="stringliteral">&quot;-D&quot;</span>, 2) == 0)</div>
<div class="line">      printdata = <span class="charliteral">&#39;D&#39;</span>;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* Set bit flag to validate CRC */</span></div>
<div class="line">  flags |= <a class="code hl_define" href="group__control-flags.html#gab06edaad68767eb4f5603d3fcb3eeb13">MSF_VALIDATECRC</a>;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* Set bit flag to build a record list */</span></div>
<div class="line">  flags |= <a class="code hl_define" href="group__control-flags.html#gae9e461a94246a154dbf24dd691ff28f6">MSF_RECORDLIST</a>;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* Read all miniSEED into a trace list, limiting to selections */</span></div>
<div class="line">  rv = <a class="code hl_function" href="group__io-functions.html#gadba1db9680c4e40ea9c680f3eb1b753e">ms3_readtracelist</a> (&amp;mstl, mseedfile, NULL, 0, flags, verbose);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (rv != <a class="code hl_define" href="group__return-values.html#ga91727033ca93e4d2b47ecb80243b054d">MS_NOERROR</a>)</div>
<div class="line">  {</div>
<div class="line">    <a class="code hl_define" href="group__logging.html#ga2d51fa9deb29995ef93287db5e7b11c4">ms_log</a> (2, <span class="stringliteral">&quot;Cannot read miniSEED from file: %s\n&quot;</span>, <a class="code hl_function" href="group__utility-functions.html#gac7d8c8a631b2d333da3246610b75f079">ms_errorstr</a>(rv));</div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* Traverse trace list structures and print summary information */</span></div>
<div class="line">  tid = mstl-&gt;<a class="code hl_variable" href="group__trace-list.html#a4dddb7dd95226889820e4e8046c8bcb8">traces</a>;</div>
<div class="line">  <span class="keywordflow">while</span> (tid)</div>
<div class="line">  {</div>
<div class="line">    <a class="code hl_define" href="group__logging.html#ga2d51fa9deb29995ef93287db5e7b11c4">ms_log</a> (0, <span class="stringliteral">&quot;TraceID for %s (%d), segments: %u\n&quot;</span>,</div>
<div class="line">            tid-&gt;<a class="code hl_variable" href="group__trace-list.html#aaa4e9d9d9fb4c2bf4f93472500744c52">sid</a>, tid-&gt;<a class="code hl_variable" href="group__trace-list.html#a49a7a751c8f59f769ec3b6e29e8aacfd">pubversion</a>, tid-&gt;<a class="code hl_variable" href="group__trace-list.html#afdbdeb4baba7b1b2bbdb92738344b70c">numsegments</a>);</div>
<div class="line"> </div>
<div class="line">    seg = tid-&gt;<a class="code hl_variable" href="group__trace-list.html#a2c57e9aa2e2b922b57df9ea8031aebde">first</a>;</div>
<div class="line">    <span class="keywordflow">while</span> (seg)</div>
<div class="line">    {</div>
<div class="line">      <span class="keywordflow">if</span> (!<a class="code hl_function" href="group__time-related.html#gafc71e63c89345baaba450780d1066235">ms_nstime2timestr</a> (seg-&gt;<a class="code hl_variable" href="group__trace-list.html#afa4b2623a8ffb336a9d9d9a9773c0dc0">starttime</a>, starttimestr, ISOMONTHDAY, NANO) ||</div>
<div class="line">          !<a class="code hl_function" href="group__time-related.html#gafc71e63c89345baaba450780d1066235">ms_nstime2timestr</a> (seg-&gt;<a class="code hl_variable" href="group__trace-list.html#a2c33217da025db4c975c4013629d53eb">endtime</a>, endtimestr, ISOMONTHDAY, NANO))</div>
<div class="line">      {</div>
<div class="line">        <a class="code hl_define" href="group__logging.html#ga2d51fa9deb29995ef93287db5e7b11c4">ms_log</a> (2, <span class="stringliteral">&quot;Cannot create time strings\n&quot;</span>);</div>
<div class="line">        starttimestr[0] = endtimestr[0] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">      <a class="code hl_define" href="group__logging.html#ga2d51fa9deb29995ef93287db5e7b11c4">ms_log</a> (0, <span class="stringliteral">&quot;  Segment %s - %s, samples: %&quot;</span> PRId64 <span class="stringliteral">&quot;, sample rate: %g\n&quot;</span>,</div>
<div class="line">              starttimestr, endtimestr, seg-&gt;<a class="code hl_variable" href="group__trace-list.html#aa7c0b61595ae856dbf409db56cc74bcc">samplecnt</a>, seg-&gt;<a class="code hl_variable" href="group__trace-list.html#acb10e4263b0aeaab66232c35d8c7d5ac">samprate</a>);</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">if</span> (seg-&gt;<a class="code hl_variable" href="group__trace-list.html#a110824afd3948973a5b015e68e90bd36">recordlist</a>)</div>
<div class="line">      {</div>
<div class="line">        <a class="code hl_define" href="group__logging.html#ga2d51fa9deb29995ef93287db5e7b11c4">ms_log</a> (0, <span class="stringliteral">&quot;  Record list:\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* Traverse record list print summary information */</span></div>
<div class="line">        recptr = seg-&gt;<a class="code hl_variable" href="group__trace-list.html#a110824afd3948973a5b015e68e90bd36">recordlist</a>-&gt;<a class="code hl_variable" href="group__record-list.html#a6bd5bfade2159b8bb2a1d201323f8d2b">first</a>;</div>
<div class="line">        <span class="keywordflow">while</span> (recptr)</div>
<div class="line">        {</div>
<div class="line">          <span class="keywordflow">if</span> (recptr-&gt;<a class="code hl_variable" href="group__record-list.html#aaef0f6a62aa670aee60244b934b935a2">bufferptr</a> == NULL)</div>
<div class="line">            strcpy (bufferptrstr, <span class="stringliteral">&quot;NULL&quot;</span>);</div>
<div class="line">          <span class="keywordflow">else</span></div>
<div class="line">            snprintf (bufferptrstr, <span class="keyword">sizeof</span>(bufferptrstr), <span class="stringliteral">&quot;%&quot;</span> PRIu64, (uint64_t)recptr-&gt;<a class="code hl_variable" href="group__record-list.html#aaef0f6a62aa670aee60244b934b935a2">bufferptr</a>);</div>
<div class="line"> </div>
<div class="line">          <span class="keywordflow">if</span> (recptr-&gt;<a class="code hl_variable" href="group__record-list.html#ab111fd7ecab5397692070960158328b6">fileptr</a> == NULL)</div>
<div class="line">            strcpy (fileptrstr, <span class="stringliteral">&quot;NULL&quot;</span>);</div>
<div class="line">          <span class="keywordflow">else</span></div>
<div class="line">            snprintf (fileptrstr, <span class="keyword">sizeof</span>(fileptrstr), <span class="stringliteral">&quot;%&quot;</span> PRIu64, (uint64_t)recptr-&gt;<a class="code hl_variable" href="group__record-list.html#ab111fd7ecab5397692070960158328b6">fileptr</a>);</div>
<div class="line"> </div>
<div class="line">          <a class="code hl_define" href="group__logging.html#ga2d51fa9deb29995ef93287db5e7b11c4">ms_log</a> (0, <span class="stringliteral">&quot;    RECORD: bufferptr: %s, fileptr: %s, filename: %s, fileoffset: %&quot;</span>PRId64<span class="stringliteral">&quot;\n&quot;</span>,</div>
<div class="line">                  bufferptrstr, fileptrstr, recptr-&gt;<a class="code hl_variable" href="group__record-list.html#a56cdc9b5211dc6b1a2340093d3272db7">filename</a>, recptr-&gt;<a class="code hl_variable" href="group__record-list.html#a56ab5d737fce6c90c5404bc0d7cfdcc3">fileoffset</a>);</div>
<div class="line">          <a class="code hl_function" href="group__time-related.html#ga1ae5238161edf95157379fb40186a37d">ms_nstime2timestrz</a> (recptr-&gt;<a class="code hl_variable" href="group__record-list.html#a7f0f4ea6a4bb9dac1357378dbfc3145a">msr</a>-&gt;<a class="code hl_variable" href="group__miniseed-record.html#a8ed5d39b9df3bfa9dd953c33d27ac73e">starttime</a>, starttimestr, ISOMONTHDAY, NANO);</div>
<div class="line">          <a class="code hl_function" href="group__time-related.html#ga1ae5238161edf95157379fb40186a37d">ms_nstime2timestrz</a> (recptr-&gt;<a class="code hl_variable" href="group__record-list.html#af074b4922203d707d08e468c10dd0aab">endtime</a>, endtimestr, ISOMONTHDAY, NANO);</div>
<div class="line">          <a class="code hl_define" href="group__logging.html#ga2d51fa9deb29995ef93287db5e7b11c4">ms_log</a> (0, <span class="stringliteral">&quot;    Start: %s, End: %s\n&quot;</span>, starttimestr, endtimestr);</div>
<div class="line"> </div>
<div class="line">          recptr = recptr-&gt;<a class="code hl_variable" href="group__record-list.html#a018dad92203bb08aa5b66f3d618c0b8f">next</a>;</div>
<div class="line">        }</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">      <span class="comment">/* Unpack and print samples for this trace segment */</span></div>
<div class="line">      <span class="keywordflow">if</span> (printdata &amp;&amp; seg-&gt;<a class="code hl_variable" href="group__trace-list.html#a110824afd3948973a5b015e68e90bd36">recordlist</a> &amp;&amp; seg-&gt;<a class="code hl_variable" href="group__trace-list.html#a110824afd3948973a5b015e68e90bd36">recordlist</a>-&gt;<a class="code hl_variable" href="group__record-list.html#a6bd5bfade2159b8bb2a1d201323f8d2b">first</a>)</div>
<div class="line">      {</div>
<div class="line">        <span class="comment">/* Determine sample size and type based on encoding of first record */</span></div>
<div class="line">        <a class="code hl_function" href="group__utility-functions.html#ga7c73f66eed548c764a62cf75556157a4">ms_encoding_sizetype</a> (seg-&gt;<a class="code hl_variable" href="group__trace-list.html#a110824afd3948973a5b015e68e90bd36">recordlist</a>-&gt;<a class="code hl_variable" href="group__record-list.html#a6bd5bfade2159b8bb2a1d201323f8d2b">first</a>-&gt;<a class="code hl_variable" href="group__record-list.html#a7f0f4ea6a4bb9dac1357378dbfc3145a">msr</a>-&gt;<a class="code hl_variable" href="group__miniseed-record.html#a63ee8e965be55863765c56016873be17">encoding</a>, &amp;samplesize, &amp;sampletype);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* Unpack data samples using record list.</span></div>
<div class="line"><span class="comment">         * No data buffer is supplied, so it will be allocated and assigned to the segment.</span></div>
<div class="line"><span class="comment">         * Alternatively, a user-specified data buffer can be provided here. */</span></div>
<div class="line">        unpacked = <a class="code hl_function" href="group__trace-list.html#ga61e3899b8390546f6d2a725d2a2e137a">mstl3_unpack_recordlist</a> (tid, seg, NULL, 0, verbose);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (unpacked != seg-&gt;<a class="code hl_variable" href="group__trace-list.html#aa7c0b61595ae856dbf409db56cc74bcc">samplecnt</a>)</div>
<div class="line">        {</div>
<div class="line">          <a class="code hl_define" href="group__logging.html#ga2d51fa9deb29995ef93287db5e7b11c4">ms_log</a> (2, <span class="stringliteral">&quot;Cannot unpack samples for %s\n&quot;</span>, tid-&gt;<a class="code hl_variable" href="group__trace-list.html#aaa4e9d9d9fb4c2bf4f93472500744c52">sid</a>);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">          <a class="code hl_define" href="group__logging.html#ga2d51fa9deb29995ef93287db5e7b11c4">ms_log</a> (0, <span class="stringliteral">&quot;DATA (%&quot;</span> PRId64 <span class="stringliteral">&quot; samples) of type &#39;%c&#39;:\n&quot;</span>, seg-&gt;<a class="code hl_variable" href="group__trace-list.html#a04a949bf1a75ed3008e22243922fe53c">numsamples</a>, seg-&gt;<a class="code hl_variable" href="group__trace-list.html#a9addbbe3f6cbb7f742b8def029cde74e">sampletype</a>);</div>
<div class="line"> </div>
<div class="line">          <span class="keywordflow">if</span> (sampletype == <span class="charliteral">&#39;a&#39;</span>)</div>
<div class="line">          {</div>
<div class="line">            printf (<span class="stringliteral">&quot;%*s&quot;</span>,</div>
<div class="line">                    (seg-&gt;<a class="code hl_variable" href="group__trace-list.html#a04a949bf1a75ed3008e22243922fe53c">numsamples</a> &gt; INT_MAX) ? INT_MAX : (<span class="keywordtype">int</span>)seg-&gt;<a class="code hl_variable" href="group__trace-list.html#a04a949bf1a75ed3008e22243922fe53c">numsamples</a>,</div>
<div class="line">                    (<span class="keywordtype">char</span> *)seg-&gt;<a class="code hl_variable" href="group__trace-list.html#a91240518702ddde33ea492251c4ad1ad">datasamples</a>);</div>
<div class="line">          }</div>
<div class="line">          <span class="keywordflow">else</span></div>
<div class="line">          {</div>
<div class="line">            lines = (unpacked / 6) + 1;</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">for</span> (idx = 0, lineidx = 0; lineidx &lt; lines; lineidx++)</div>
<div class="line">            {</div>
<div class="line">              <span class="keywordflow">for</span> (col = 0; col &lt; 6 &amp;&amp; idx &lt; seg-&gt;<a class="code hl_variable" href="group__trace-list.html#a04a949bf1a75ed3008e22243922fe53c">numsamples</a>; col++)</div>
<div class="line">              {</div>
<div class="line">                sptr = (<span class="keywordtype">char</span> *)seg-&gt;<a class="code hl_variable" href="group__trace-list.html#a91240518702ddde33ea492251c4ad1ad">datasamples</a> + (idx * samplesize);</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">if</span> (sampletype == <span class="charliteral">&#39;i&#39;</span>)</div>
<div class="line">                  <a class="code hl_define" href="group__logging.html#ga2d51fa9deb29995ef93287db5e7b11c4">ms_log</a> (0, <span class="stringliteral">&quot;%10d  &quot;</span>, *(int32_t *)sptr);</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sampletype == <span class="charliteral">&#39;f&#39;</span>)</div>
<div class="line">                  <a class="code hl_define" href="group__logging.html#ga2d51fa9deb29995ef93287db5e7b11c4">ms_log</a> (0, <span class="stringliteral">&quot;%10.8g  &quot;</span>, *(<span class="keywordtype">float</span> *)sptr);</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sampletype == <span class="charliteral">&#39;d&#39;</span>)</div>
<div class="line">                  <a class="code hl_define" href="group__logging.html#ga2d51fa9deb29995ef93287db5e7b11c4">ms_log</a> (0, <span class="stringliteral">&quot;%10.10g  &quot;</span>, *(<span class="keywordtype">double</span> *)sptr);</div>
<div class="line"> </div>
<div class="line">                idx++;</div>
<div class="line">              }</div>
<div class="line">              <a class="code hl_define" href="group__logging.html#ga2d51fa9deb29995ef93287db5e7b11c4">ms_log</a> (0, <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">              <span class="keywordflow">if</span> (printdata == <span class="charliteral">&#39;d&#39;</span>)</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">          }</div>
<div class="line">        }</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">      seg = seg-&gt;<a class="code hl_variable" href="group__trace-list.html#ad5acfe831d046c60102414e333cb46a3">next</a>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    tid = tid-&gt;<a class="code hl_variable" href="group__trace-list.html#a7010e1a21bb73ccf12c5bbd783bfc9da">next</a>;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* Make sure everything is cleaned up */</span></div>
<div class="line">  <span class="keywordflow">if</span> (mstl)</div>
<div class="line">    <a class="code hl_function" href="group__trace-list.html#ga2a436ab4eb7cd653e52e6760c2f51f20">mstl3_free</a> (&amp;mstl, 0);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="agroup__control-flags_html_gae9e461a94246a154dbf24dd691ff28f6"><div class="ttname"><a href="group__control-flags.html#gae9e461a94246a154dbf24dd691ff28f6">MSF_RECORDLIST</a></div><div class="ttdeci">#define MSF_RECORDLIST</div><div class="ttdoc">[TraceList] Build a MS3RecordList for each MS3TraceSeg</div><div class="ttdef"><b>Definition:</b> libmseed.h:1352</div></div>
<div class="ttc" id="agroup__io-functions_html_gadba1db9680c4e40ea9c680f3eb1b753e"><div class="ttname"><a href="group__io-functions.html#gadba1db9680c4e40ea9c680f3eb1b753e">ms3_readtracelist</a></div><div class="ttdeci">int ms3_readtracelist(MS3TraceList **ppmstl, const char *mspath, MS3Tolerance *tolerance, int8_t splitversion, uint32_t flags, int8_t verbose)</div><div class="ttdoc">Read miniSEED from a file into a trace list.</div><div class="ttdef"><b>Definition:</b> fileutils.c:577</div></div>
<div class="ttc" id="agroup__miniseed-record_html_a63ee8e965be55863765c56016873be17"><div class="ttname"><a href="group__miniseed-record.html#a63ee8e965be55863765c56016873be17">MS3Record::encoding</a></div><div class="ttdeci">int8_t encoding</div><div class="ttdoc">Data encoding format, see Data Encodings.</div><div class="ttdef"><b>Definition:</b> libmseed.h:334</div></div>
<div class="ttc" id="agroup__miniseed-record_html_a8ed5d39b9df3bfa9dd953c33d27ac73e"><div class="ttname"><a href="group__miniseed-record.html#a8ed5d39b9df3bfa9dd953c33d27ac73e">MS3Record::starttime</a></div><div class="ttdeci">nstime_t starttime</div><div class="ttdoc">Record start time (first sample)</div><div class="ttdef"><b>Definition:</b> libmseed.h:332</div></div>
<div class="ttc" id="agroup__record-list_html_a018dad92203bb08aa5b66f3d618c0b8f"><div class="ttname"><a href="group__record-list.html#a018dad92203bb08aa5b66f3d618c0b8f">MS3RecordPtr::next</a></div><div class="ttdeci">struct MS3RecordPtr * next</div><div class="ttdoc">Pointer to next entry, NULL if the last.</div><div class="ttdef"><b>Definition:</b> libmseed.h:466</div></div>
<div class="ttc" id="agroup__record-list_html_a56ab5d737fce6c90c5404bc0d7cfdcc3"><div class="ttname"><a href="group__record-list.html#a56ab5d737fce6c90c5404bc0d7cfdcc3">MS3RecordPtr::fileoffset</a></div><div class="ttdeci">int64_t fileoffset</div><div class="ttdoc">Offset into file to record for fileptr or filename.</div><div class="ttdef"><b>Definition:</b> libmseed.h:461</div></div>
<div class="ttc" id="agroup__record-list_html_a56cdc9b5211dc6b1a2340093d3272db7"><div class="ttname"><a href="group__record-list.html#a56cdc9b5211dc6b1a2340093d3272db7">MS3RecordPtr::filename</a></div><div class="ttdeci">const char * filename</div><div class="ttdoc">Pointer to file name containing record, NULL if not used.</div><div class="ttdef"><b>Definition:</b> libmseed.h:460</div></div>
<div class="ttc" id="agroup__record-list_html_a6bd5bfade2159b8bb2a1d201323f8d2b"><div class="ttname"><a href="group__record-list.html#a6bd5bfade2159b8bb2a1d201323f8d2b">MS3RecordList::first</a></div><div class="ttdeci">MS3RecordPtr * first</div><div class="ttdoc">Pointer to first entry, NULL if the none.</div><div class="ttdef"><b>Definition:</b> libmseed.h:473</div></div>
<div class="ttc" id="agroup__record-list_html_a7f0f4ea6a4bb9dac1357378dbfc3145a"><div class="ttname"><a href="group__record-list.html#a7f0f4ea6a4bb9dac1357378dbfc3145a">MS3RecordPtr::msr</a></div><div class="ttdeci">MS3Record * msr</div><div class="ttdoc">Pointer to MS3Record for this record.</div><div class="ttdef"><b>Definition:</b> libmseed.h:462</div></div>
<div class="ttc" id="agroup__record-list_html_aaef0f6a62aa670aee60244b934b935a2"><div class="ttname"><a href="group__record-list.html#aaef0f6a62aa670aee60244b934b935a2">MS3RecordPtr::bufferptr</a></div><div class="ttdeci">const char * bufferptr</div><div class="ttdoc">Pointer in buffer to record, NULL if not used.</div><div class="ttdef"><b>Definition:</b> libmseed.h:458</div></div>
<div class="ttc" id="agroup__record-list_html_ab111fd7ecab5397692070960158328b6"><div class="ttname"><a href="group__record-list.html#ab111fd7ecab5397692070960158328b6">MS3RecordPtr::fileptr</a></div><div class="ttdeci">FILE * fileptr</div><div class="ttdoc">Pointer to open FILE containing record, NULL if not used.</div><div class="ttdef"><b>Definition:</b> libmseed.h:459</div></div>
<div class="ttc" id="agroup__record-list_html_af074b4922203d707d08e468c10dd0aab"><div class="ttname"><a href="group__record-list.html#af074b4922203d707d08e468c10dd0aab">MS3RecordPtr::endtime</a></div><div class="ttdeci">nstime_t endtime</div><div class="ttdoc">End time of record, time of last sample.</div><div class="ttdef"><b>Definition:</b> libmseed.h:463</div></div>
<div class="ttc" id="agroup__record-list_html_struct_m_s3_record_ptr"><div class="ttname"><a href="group__record-list.html#struct_m_s3_record_ptr">MS3RecordPtr</a></div><div class="ttdoc">A miniSEED record pointer and metadata.</div><div class="ttdef"><b>Definition:</b> libmseed.h:457</div></div>
<div class="ttc" id="agroup__time-related_html_ga1ae5238161edf95157379fb40186a37d"><div class="ttname"><a href="group__time-related.html#ga1ae5238161edf95157379fb40186a37d">ms_nstime2timestrz</a></div><div class="ttdeci">char * ms_nstime2timestrz(nstime_t nstime, char *timestr, ms_timeformat_t timeformat, ms_subseconds_t subsecond)</div><div class="ttdoc">Convert an nstime_t to a time string with 'Z' suffix.</div><div class="ttdef"><b>Definition:</b> genutils.c:1077</div></div>
<div class="ttc" id="agroup__trace-list_html_a110824afd3948973a5b015e68e90bd36"><div class="ttname"><a href="group__trace-list.html#a110824afd3948973a5b015e68e90bd36">MS3TraceSeg::recordlist</a></div><div class="ttdeci">struct MS3RecordList * recordlist</div><div class="ttdoc">List of pointers to records that contributed.</div><div class="ttdef"><b>Definition:</b> libmseed.h:521</div></div>
<div class="ttc" id="agroup__trace-list_html_a91240518702ddde33ea492251c4ad1ad"><div class="ttname"><a href="group__trace-list.html#a91240518702ddde33ea492251c4ad1ad">MS3TraceSeg::datasamples</a></div><div class="ttdeci">void * datasamples</div><div class="ttdoc">Data samples, numsamples of type sampletype.</div><div class="ttdef"><b>Definition:</b> libmseed.h:516</div></div>
<div class="ttc" id="agroup__trace-list_html_aa7c0b61595ae856dbf409db56cc74bcc"><div class="ttname"><a href="group__trace-list.html#aa7c0b61595ae856dbf409db56cc74bcc">MS3TraceSeg::samplecnt</a></div><div class="ttdeci">int64_t samplecnt</div><div class="ttdoc">Number of samples in trace coverage.</div><div class="ttdef"><b>Definition:</b> libmseed.h:515</div></div>
<div class="ttc" id="agroup__trace-list_html_ga61e3899b8390546f6d2a725d2a2e137a"><div class="ttname"><a href="group__trace-list.html#ga61e3899b8390546f6d2a725d2a2e137a">mstl3_unpack_recordlist</a></div><div class="ttdeci">int64_t mstl3_unpack_recordlist(MS3TraceID *id, MS3TraceSeg *seg, void *output, size_t outputsize, int8_t verbose)</div><div class="ttdoc">Unpack data samples in a Record List associated with a MS3TraceList.</div><div class="ttdef"><b>Definition:</b> tracelist.c:1574</div></div>
<div class="ttc" id="agroup__utility-functions_html_ga7c73f66eed548c764a62cf75556157a4"><div class="ttname"><a href="group__utility-functions.html#ga7c73f66eed548c764a62cf75556157a4">ms_encoding_sizetype</a></div><div class="ttdeci">int ms_encoding_sizetype(const uint8_t encoding, uint8_t *samplesize, char *sampletype)</div><div class="ttdoc">Return sample size and/or type for given encoding value.</div><div class="ttdef"><b>Definition:</b> lookup.c:73</div></div>
</div><!-- fragment --><h1><a class="anchor" id="example-lm_read_buffer"></a>
Reading from memory buffers</h1>
<p >Read miniSEED from memory buffers. In this case a file is read into a buffer simply to illustrate reading from a buffer. In practice this would functionality would be used with data received via a network connection or some other, non-file, mechanism.</p>
<div class="fragment"><div class="line"><span class="comment">/***************************************************************************</span></div>
<div class="line"><span class="comment"> * A program illustrating reading miniSEED from buffers</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * This file is part of the miniSEED Library.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Copyright (c) 2020 Chad Trabant, IRIS Data Management Center</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span></div>
<div class="line"><span class="comment"> * you may not use this file except in compliance with the License.</span></div>
<div class="line"><span class="comment"> * You may obtain a copy of the License at</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *   http://www.apache.org/licenses/LICENSE-2.0</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Unless required by applicable law or agreed to in writing, software</span></div>
<div class="line"><span class="comment"> * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></div>
<div class="line"><span class="comment"> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></div>
<div class="line"><span class="comment"> * See the License for the specific language governing permissions and</span></div>
<div class="line"><span class="comment"> * limitations under the License.</span></div>
<div class="line"><span class="comment"> ***************************************************************************/</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;errno.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sys/stat.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="libmseed_8h.html">libmseed.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span></div>
<div class="line">main (<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">struct </span>stat sb  = {0};</div>
<div class="line">  int64_t records = 0;</div>
<div class="line">  FILE *fh;</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_struct" href="group__trace-list.html#struct_m_s3_trace_list">MS3TraceList</a> *mstl    = NULL;</div>
<div class="line">  <span class="keywordtype">char</span> *buffer          = NULL;</div>
<div class="line">  uint64_t bufferlength = 0;</div>
<div class="line">  int8_t splitversion   = 0;</div>
<div class="line">  uint32_t flags        = 0;</div>
<div class="line">  int8_t verbose        = 0;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (argc != 2)</div>
<div class="line">  {</div>
<div class="line">    <a class="code hl_define" href="group__logging.html#ga2d51fa9deb29995ef93287db5e7b11c4">ms_log</a> (2, <span class="stringliteral">&quot;%s requires a single file name argument\n&quot;</span>, argv[0]);</div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* Read specified file into buffer */</span></div>
<div class="line">  <span class="keywordflow">if</span> (!(fh = fopen (argv[1], <span class="stringliteral">&quot;rb&quot;</span>)))</div>
<div class="line">  {</div>
<div class="line">    <a class="code hl_define" href="group__logging.html#ga2d51fa9deb29995ef93287db5e7b11c4">ms_log</a> (2, <span class="stringliteral">&quot;Error opening %s: %s\n&quot;</span>, argv[1], strerror (errno));</div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">if</span> (fstat (fileno (fh), &amp;sb))</div>
<div class="line">  {</div>
<div class="line">    <a class="code hl_define" href="group__logging.html#ga2d51fa9deb29995ef93287db5e7b11c4">ms_log</a> (2, <span class="stringliteral">&quot;Error stating %s: %s\n&quot;</span>, argv[1], strerror (errno));</div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">if</span> (!(buffer = (<span class="keywordtype">char</span> *)malloc (sb.st_size)))</div>
<div class="line">  {</div>
<div class="line">    <a class="code hl_define" href="group__logging.html#ga2d51fa9deb29995ef93287db5e7b11c4">ms_log</a> (2, <span class="stringliteral">&quot;Error allocating buffer of %&quot;</span> <a class="code hl_define" href="libmseed_8h.html#af847123129aadbc5ea749d63ef0ce82f">PRIsize_t</a> <span class="stringliteral">&quot; bytes\n&quot;</span>,</div>
<div class="line">            (sb.st_size &gt;= 0) ? (<span class="keywordtype">size_t</span>)sb.st_size : 0);</div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">if</span> (fread (buffer, sb.st_size, 1, fh) != 1)</div>
<div class="line">  {</div>
<div class="line">    <a class="code hl_define" href="group__logging.html#ga2d51fa9deb29995ef93287db5e7b11c4">ms_log</a> (2, <span class="stringliteral">&quot;Error reading file\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  fclose (fh);</div>
<div class="line"> </div>
<div class="line">  bufferlength = sb.st_size;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* Set bit flags to validate CRC and unpack data samples */</span></div>
<div class="line">  flags |= <a class="code hl_define" href="group__control-flags.html#gab06edaad68767eb4f5603d3fcb3eeb13">MSF_VALIDATECRC</a>;</div>
<div class="line">  flags |= <a class="code hl_define" href="group__control-flags.html#ga95033e92e20f803ae8e3daebca1a2b5b">MSF_UNPACKDATA</a>;</div>
<div class="line"> </div>
<div class="line">  mstl = <a class="code hl_function" href="group__trace-list.html#gac23dc184eac5bbfec546e1079ea4aed7">mstl3_init</a> (NULL);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (!mstl)</div>
<div class="line">  {</div>
<div class="line">    <a class="code hl_define" href="group__logging.html#ga2d51fa9deb29995ef93287db5e7b11c4">ms_log</a> (2, <span class="stringliteral">&quot;Error allocating MS3TraceList\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* Read all miniSEED in buffer, accumulate in MS3TraceList */</span></div>
<div class="line">  records = <a class="code hl_function" href="group__trace-list.html#ga0fc8e37886c7b346929dcede76d686fc">mstl3_readbuffer</a> (&amp;mstl, buffer, bufferlength,</div>
<div class="line">                              splitversion, flags, NULL, verbose);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (records &lt; 0)</div>
<div class="line">  {</div>
<div class="line">    <a class="code hl_define" href="group__logging.html#ga2d51fa9deb29995ef93287db5e7b11c4">ms_log</a> (2, <span class="stringliteral">&quot;Problem reading miniSEED from buffer: %s\n&quot;</span>, <a class="code hl_function" href="group__utility-functions.html#gac7d8c8a631b2d333da3246610b75f079">ms_errorstr</a> (records));</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* Print summary */</span></div>
<div class="line">  <a class="code hl_function" href="group__trace-list.html#gad6999931a86547276deb85b36145ccd6">mstl3_printtracelist</a> (mstl, ISOMONTHDAY, 1, 1);</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_define" href="group__logging.html#ga2d51fa9deb29995ef93287db5e7b11c4">ms_log</a> (1, <span class="stringliteral">&quot;Total records: %&quot;</span> PRId64 <span class="stringliteral">&quot;\n&quot;</span>, records);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* Make sure everything is cleaned up */</span></div>
<div class="line">  <span class="keywordflow">if</span> (mstl)</div>
<div class="line">    <a class="code hl_function" href="group__trace-list.html#ga2a436ab4eb7cd653e52e6760c2f51f20">mstl3_free</a> (&amp;mstl, 0);</div>
<div class="line"> </div>
<div class="line">  free (buffer);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="agroup__trace-list_html_ga0fc8e37886c7b346929dcede76d686fc"><div class="ttname"><a href="group__trace-list.html#ga0fc8e37886c7b346929dcede76d686fc">mstl3_readbuffer</a></div><div class="ttdeci">int64_t mstl3_readbuffer(MS3TraceList **ppmstl, char *buffer, uint64_t bufferlength, int8_t splitversion, uint32_t flags, MS3Tolerance *tolerance, int8_t verbose)</div><div class="ttdoc">Parse miniSEED from a buffer and populate a MS3TraceList.</div><div class="ttdef"><b>Definition:</b> tracelist.c:786</div></div>
<div class="ttc" id="agroup__trace-list_html_gac23dc184eac5bbfec546e1079ea4aed7"><div class="ttname"><a href="group__trace-list.html#gac23dc184eac5bbfec546e1079ea4aed7">mstl3_init</a></div><div class="ttdeci">MS3TraceList * mstl3_init(MS3TraceList *mstl)</div><div class="ttdoc">Initialize a MS3TraceList container.</div><div class="ttdef"><b>Definition:</b> tracelist.c:48</div></div>
<div class="ttc" id="agroup__trace-list_html_gad6999931a86547276deb85b36145ccd6"><div class="ttname"><a href="group__trace-list.html#gad6999931a86547276deb85b36145ccd6">mstl3_printtracelist</a></div><div class="ttdeci">void mstl3_printtracelist(MS3TraceList *mstl, ms_timeformat_t timeformat, int8_t details, int8_t gaps)</div><div class="ttdoc">Print trace list summary information for a MS3TraceList.</div><div class="ttdef"><b>Definition:</b> tracelist.c:2079</div></div>
<div class="ttc" id="alibmseed_8h_html_af847123129aadbc5ea749d63ef0ce82f"><div class="ttname"><a href="libmseed_8h.html#af847123129aadbc5ea749d63ef0ce82f">PRIsize_t</a></div><div class="ttdeci">#define PRIsize_t</div><div class="ttdoc">A printf() macro for portably printing size_t values.</div><div class="ttdef"><b>Definition:</b> libmseed.h:69</div></div>
</div><!-- fragment --><h1><a class="anchor" id="example-lm_pararead"></a>
Reading files in parallel</h1>
<p >Read miniSEED in parallel using re-entrant interfaces and POSIX threading.</p>
<div class="fragment"><div class="line"><span class="comment">/***************************************************************************</span></div>
<div class="line"><span class="comment"> * A simple example of using libmseed to read miniSEED in parallel</span></div>
<div class="line"><span class="comment"> * using re-entrant interfaces and POSIX threading.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Windows is not supported.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * This file is part of the miniSEED Library.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Copyright (c) 2021 Chad Trabant, IRIS Data Management Center</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span></div>
<div class="line"><span class="comment"> * you may not use this file except in compliance with the License.</span></div>
<div class="line"><span class="comment"> * You may obtain a copy of the License at</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *   http://www.apache.org/licenses/LICENSE-2.0</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Unless required by applicable law or agreed to in writing, software</span></div>
<div class="line"><span class="comment"> * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></div>
<div class="line"><span class="comment"> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></div>
<div class="line"><span class="comment"> * See the License for the specific language governing permissions and</span></div>
<div class="line"><span class="comment"> * limitations under the License.</span></div>
<div class="line"><span class="comment"> ***************************************************************************/</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;errno.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;time.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="libmseed_8h.html">libmseed.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* File read test portability, possibly in the future */</span></div>
<div class="line"><span class="preprocessor">#if defined(LMP_WIN)</span></div>
<div class="line"><span class="preprocessor">  #define _access access</span></div>
<div class="line"><span class="preprocessor">  #define R_OK    4       </span><span class="comment">/* Test for read permission */</span><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line"><span class="preprocessor">  #include &lt;pthread.h&gt;</span></div>
<div class="line"><span class="preprocessor">  #include &lt;unistd.h&gt;</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define VERSION &quot;[libmseed &quot;</span> LIBMSEED_VERSION &quot; example]&quot;</div>
<div class="line"><span class="preprocessor">#define PACKAGE &quot;lm_pararead&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> int8_t verbose = 0;</div>
<div class="line"><span class="keyword">static</span> int8_t printrecs = 0;</div>
<div class="line"><span class="keyword">static</span> uint32_t readflags = 0;</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* File information structure */</span></div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>FileEntry</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">char</span> *filename;</div>
<div class="line">  pthread_t tid;</div>
<div class="line">  <a class="code hl_struct" href="group__trace-list.html#struct_m_s3_trace_list">MS3TraceList</a> *mstl;</div>
<div class="line">  uint64_t recordcount;</div>
<div class="line">  <span class="keywordtype">int</span> result;</div>
<div class="line">  <span class="keyword">struct </span>FileEntry *next;</div>
<div class="line">} FileEntry;</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* List of files to read */</span></div>
<div class="line"><span class="keyword">static</span> FileEntry *files = NULL;</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Thread function to read miniSEED file */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> *ReadMSFileThread (<span class="keywordtype">void</span> *vfe)</div>
<div class="line">{</div>
<div class="line">  FileEntry *fe      = (FileEntry *)vfe;</div>
<div class="line">  <a class="code hl_struct" href="group__io-functions.html#struct_m_s3_file_param">MS3FileParam</a> *msfp = NULL;</div>
<div class="line">  <a class="code hl_struct" href="group__miniseed-record.html#struct_m_s3_record">MS3Record</a> *msr     = NULL;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* NOTE: This example is contrived for illustration.</span></div>
<div class="line"><span class="comment">   * The combination of ms3_readmsr_r() with mstl3_addmsr()</span></div>
<div class="line"><span class="comment">   * is only needed if you wish to do something for each record.</span></div>
<div class="line"><span class="comment">   * Otherwise, consider using ms3_readtracelist() if only</span></div>
<div class="line"><span class="comment">   * a MS3TraceList is desired.*/</span></div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* Loop over the input file record by record */</span></div>
<div class="line">  <span class="keywordflow">while</span> ((fe-&gt;result = <a class="code hl_function" href="group__io-functions.html#gac67175755fed41e3e3beed8e27b82da9">ms3_readmsr_r</a> (&amp;msfp, &amp;msr,</div>
<div class="line">                                      fe-&gt;filename,</div>
<div class="line">                                      NULL, NULL,</div>
<div class="line">                                      readflags, verbose)) == <a class="code hl_define" href="group__return-values.html#ga91727033ca93e4d2b47ecb80243b054d">MS_NOERROR</a>)</div>
<div class="line">  {</div>
<div class="line">    fe-&gt;recordcount++;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (printrecs &gt; 0)</div>
<div class="line">      <a class="code hl_function" href="group__miniseed-record.html#gaad6b4c5c5194d338f9d89dfe84b44bd9">msr3_print</a> (msr, printrecs - 1);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Add record to trace list */</span></div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code hl_define" href="group__trace-list.html#ga9f56917332e05aa2e22c167014f9efed">mstl3_addmsr</a> (fe-&gt;mstl, msr, 0, 1, 0, NULL) == NULL)</div>
<div class="line">    {</div>
<div class="line">      <a class="code hl_define" href="group__logging.html#ga2d51fa9deb29995ef93287db5e7b11c4">ms_log</a> (2, <span class="stringliteral">&quot;Error adding record to list\n&quot;</span>);</div>
<div class="line">      fe-&gt;result = 1;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* Make sure everything is cleaned up */</span></div>
<div class="line">  <a class="code hl_function" href="group__io-functions.html#gac67175755fed41e3e3beed8e27b82da9">ms3_readmsr_r</a> (&amp;msfp, &amp;msr, NULL, NULL, NULL, 0, 0);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> NULL;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span></div>
<div class="line">main (<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)</div>
<div class="line">{</div>
<div class="line">  FileEntry *fe    = NULL;</div>
<div class="line">  <span class="keywordtype">int</span> idx;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* Simplistic argument parsing */</span></div>
<div class="line">  <span class="keywordflow">for</span> (idx = 1; idx &lt; argc; idx++)</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordflow">if</span> (strncmp (argv[idx], <span class="stringliteral">&quot;-v&quot;</span>, 2) == 0)</div>
<div class="line">      verbose += strspn (&amp;argv[idx][1], <span class="stringliteral">&quot;v&quot;</span>);</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strncmp (argv[idx], <span class="stringliteral">&quot;-p&quot;</span>, 2) == 0)</div>
<div class="line">      printrecs += strspn (&amp;argv[idx][1], <span class="stringliteral">&quot;p&quot;</span>);</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line">      <span class="comment">/* Add read-able files to file entry list */</span></div>
<div class="line">      <span class="keywordflow">if</span> (access(argv[idx], R_OK) == 0)</div>
<div class="line">      {</div>
<div class="line">        <span class="keywordflow">if</span> ((fe = (FileEntry *)malloc(<span class="keyword">sizeof</span>(FileEntry))) == NULL)</div>
<div class="line">        {</div>
<div class="line">          <a class="code hl_define" href="group__logging.html#ga2d51fa9deb29995ef93287db5e7b11c4">ms_log</a> (2, <span class="stringliteral">&quot;Error allocating memory&quot;</span>);</div>
<div class="line">          <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        fe-&gt;filename = argv[idx];</div>
<div class="line">        fe-&gt;mstl = <a class="code hl_function" href="group__trace-list.html#gac23dc184eac5bbfec546e1079ea4aed7">mstl3_init</a>(NULL);</div>
<div class="line">        fe-&gt;recordcount = 0;</div>
<div class="line">        fe-&gt;result = 0;</div>
<div class="line">        fe-&gt;next = files;</div>
<div class="line"> </div>
<div class="line">        files = fe;</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">else</span></div>
<div class="line">      {</div>
<div class="line">        <a class="code hl_define" href="group__logging.html#ga2d51fa9deb29995ef93287db5e7b11c4">ms_log</a> (2, <span class="stringliteral">&quot;Cannot find file: %s\n&quot;</span>, argv[idx]);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* Make sure input file(s) specified */</span></div>
<div class="line">  <span class="keywordflow">if</span> (!files)</div>
<div class="line">  {</div>
<div class="line">    <a class="code hl_define" href="group__logging.html#ga2d51fa9deb29995ef93287db5e7b11c4">ms_log</a> (1, <span class="stringliteral">&quot;No input file(s) specified\n\n&quot;</span>);</div>
<div class="line">    <a class="code hl_define" href="group__logging.html#ga2d51fa9deb29995ef93287db5e7b11c4">ms_log</a> (1, <span class="stringliteral">&quot;%s version %s\n\n&quot;</span>, PACKAGE, VERSION);</div>
<div class="line">    <a class="code hl_define" href="group__logging.html#ga2d51fa9deb29995ef93287db5e7b11c4">ms_log</a> (1, <span class="stringliteral">&quot;Read specified miniSEED files in parallel\n\n&quot;</span>);</div>
<div class="line">    <a class="code hl_define" href="group__logging.html#ga2d51fa9deb29995ef93287db5e7b11c4">ms_log</a> (1, <span class="stringliteral">&quot;Usage: %s [-p] [-v] file1 [file2 .. fileN]\n&quot;</span>, PACKAGE);</div>
<div class="line">    <a class="code hl_define" href="group__logging.html#ga2d51fa9deb29995ef93287db5e7b11c4">ms_log</a> (1, <span class="stringliteral">&quot;  -v  Be more verbose, multiple flags can be used\n&quot;</span>);</div>
<div class="line">    <a class="code hl_define" href="group__logging.html#ga2d51fa9deb29995ef93287db5e7b11c4">ms_log</a> (1, <span class="stringliteral">&quot;  -p  Print record details, multiple flags can be used\n\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* Report the program version */</span></div>
<div class="line">  <span class="keywordflow">if</span> (verbose)</div>
<div class="line">    <a class="code hl_define" href="group__logging.html#ga2d51fa9deb29995ef93287db5e7b11c4">ms_log</a> (1, <span class="stringliteral">&quot;%s version: %s\n&quot;</span>, PACKAGE, VERSION);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* Add program name and version to User-Agent for URL-based requests */</span></div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code hl_function" href="group__io-functions.html#gaae2aee8ed2ea3bce6aa164e6c653c5c7">libmseed_url_support</a>() &amp;&amp; <a class="code hl_function" href="group__io-functions.html#gafcc98efb81d4f4adb24c9b07bd094e61">ms3_url_useragent</a>(PACKAGE, VERSION))</div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* Set flag to validate CRCs when reading */</span></div>
<div class="line">  readflags |= <a class="code hl_define" href="group__control-flags.html#gab06edaad68767eb4f5603d3fcb3eeb13">MSF_VALIDATECRC</a>;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* Parse byte range from file/URL path name if present */</span></div>
<div class="line">  readflags |= <a class="code hl_define" href="group__control-flags.html#ga902a8e77ba34f70e7cfae2aa5c1f7c8f">MSF_PNAMERANGE</a>;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* Create a thread to read each file */</span></div>
<div class="line">  <span class="keywordflow">for</span> (fe = files; fe; fe = fe-&gt;next)</div>
<div class="line">  {</div>
<div class="line">    pthread_create (&amp;(fe-&gt;tid), NULL, ReadMSFileThread, fe);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* Wait for threads to finish */</span></div>
<div class="line">  <span class="keywordflow">for</span> (fe = files; fe; fe = fe-&gt;next)</div>
<div class="line">  {</div>
<div class="line">    pthread_join(fe-&gt;tid, NULL);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* Report details for each file */</span></div>
<div class="line">  <span class="keywordflow">for</span> (fe = files; fe; fe = fe-&gt;next)</div>
<div class="line">  {</div>
<div class="line">    <a class="code hl_define" href="group__logging.html#ga2d51fa9deb29995ef93287db5e7b11c4">ms_log</a> (0, <span class="stringliteral">&quot;%s: records: %&quot;</span> PRIu64<span class="stringliteral">&quot; result: %d\n&quot;</span>,</div>
<div class="line">            fe-&gt;filename, fe-&gt;recordcount, fe-&gt;result);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (fe-&gt;result == <a class="code hl_define" href="group__return-values.html#ga91727033ca93e4d2b47ecb80243b054d">MS_NOERROR</a> || fe-&gt;result == <a class="code hl_define" href="group__return-values.html#gaaa6856cc106d8dcd273bdaa7a48082d0">MS_ENDOFFILE</a>)</div>
<div class="line">      <a class="code hl_function" href="group__trace-list.html#gad6999931a86547276deb85b36145ccd6">mstl3_printtracelist</a> (fe-&gt;mstl, ISOMONTHDAY, 1, 1);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">} <span class="comment">/* End of main() */</span></div>
<div class="ttc" id="agroup__io-functions_html_gac67175755fed41e3e3beed8e27b82da9"><div class="ttname"><a href="group__io-functions.html#gac67175755fed41e3e3beed8e27b82da9">ms3_readmsr_r</a></div><div class="ttdeci">int ms3_readmsr_r(MS3FileParam **ppmsfp, MS3Record **ppmsr, const char *mspath, int64_t *fpos, int8_t *last, uint32_t flags, int8_t verbose)</div><div class="ttdoc">Read miniSEED records from a file or URL in a thread-safe way.</div><div class="ttdef"><b>Definition:</b> fileutils.c:99</div></div>
<div class="ttc" id="agroup__io-functions_html_struct_m_s3_file_param"><div class="ttname"><a href="group__io-functions.html#struct_m_s3_file_param">MS3FileParam</a></div><div class="ttdoc">State container for reading miniSEED records from files or URLs.</div><div class="ttdef"><b>Definition:</b> libmseed.h:671</div></div>
<div class="ttc" id="agroup__trace-list_html_ga9f56917332e05aa2e22c167014f9efed"><div class="ttname"><a href="group__trace-list.html#ga9f56917332e05aa2e22c167014f9efed">mstl3_addmsr</a></div><div class="ttdeci">#define mstl3_addmsr(mstl, msr, splitversion, autoheal, flags, tolerance)</div><div class="ttdoc">Add a MS3Record to a MS3TraceList.</div><div class="ttdef"><b>Definition:</b> libmseed.h:582</div></div>
</div><!-- fragment --><h1><a class="anchor" id="example-lm_pack"></a>
Writing miniSEED</h1>
<p >An example of creating miniSEED. Static data with known signal is used for input for illustration and testing.</p>
<div class="fragment"><div class="line"><span class="comment">/***************************************************************************</span></div>
<div class="line"><span class="comment"> * A program for libmseed packing tests.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * This file is part of the miniSEED Library.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Copyright (c) 2020 Chad Trabant, IRIS Data Management Center</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span></div>
<div class="line"><span class="comment"> * you may not use this file except in compliance with the License.</span></div>
<div class="line"><span class="comment"> * You may obtain a copy of the License at</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *   http://www.apache.org/licenses/LICENSE-2.0</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Unless required by applicable law or agreed to in writing, software</span></div>
<div class="line"><span class="comment"> * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></div>
<div class="line"><span class="comment"> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></div>
<div class="line"><span class="comment"> * See the License for the specific language governing permissions and</span></div>
<div class="line"><span class="comment"> * limitations under the License.</span></div>
<div class="line"><span class="comment"> ***************************************************************************/</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;errno.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;time.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="libmseed_8h.html">libmseed.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define VERSION &quot;[libmseed &quot;</span> LIBMSEED_VERSION &quot; example]&quot;</div>
<div class="line"><span class="preprocessor">#define PACKAGE &quot;lm_pack&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <a class="code hl_typedef" href="libmseed_8h.html#a2fa2d4ca679cdb79cfa01c1cc94a7298">flag</a> verbose  = 0;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> reclen    = -1;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> encoding  = -1;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> byteorder = -1;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">char</span> *outfile = NULL;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> parameter_proc (<span class="keywordtype">int</span> argcount, <span class="keywordtype">char</span> **argvec);</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> print_stderr (<span class="keyword">const</span> <span class="keywordtype">char</span> *message);</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> usage (<span class="keywordtype">void</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* A simple, expanding sinusoid of 500 samples.</span></div>
<div class="line"><span class="comment"> * For all samples, no successive difference is greater than 30 bits (signed).</span></div>
<div class="line"><span class="comment"> *   - Good for INT32, STEIM1, STEIM2, etc.</span></div>
<div class="line"><span class="comment"> * Between index 0-400, no sample value is greater than 16 bits (signed).</span></div>
<div class="line"><span class="comment"> *   - Good for INT16.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keyword">static</span> int32_t sindata[500] =</div>
<div class="line">    {0, 2, 4, 5, 7, 9, 10, 11, 11, 11, 11, 10, 8, 6, 4, 1, 0, -3,</div>
<div class="line">     -6, -8, -11, -13, -14, -15, -16, -15, -14, -13, -11, -8, -5,</div>
<div class="line">     -1, 2, 6, 9, 13, 16, 18, 20, 21, 22, 21, 19, 17, 14, 10, 5, 0,</div>
<div class="line">     -4, -9, -14, -19, -23, -26, -29, -30, -30, -29, -26, -22, -18,</div>
<div class="line">     -12, -5, 1, 8, 15, 22, 28, 33, 38, 40, 41, 41, 39, 35, 29, 22,</div>
<div class="line">     14, 5, -4, -14, -24, -33, -41, -48, -53, -56, -57, -56, -52, -46,</div>
<div class="line">     -38, -27, -16, -3, 10, 23, 37, 49, 60, 68, 75, 78, 78, 75, 69, 60,</div>
<div class="line">     48, 33, 17, 0, -19, -38, -56, -72, -86, -97, -104, -108, -107,</div>
<div class="line">     -102, -92, -78, -60, -39, -16, 8, 34, 59, 83, 105, 123, 137, 146,</div>
<div class="line">     149, 146, 137, 122, 101, 75, 45, 12, -22, -57, -92, -124, -152,</div>
<div class="line">     -175, -192, -202, -204, -198, -183, -160, -129, -92, -50, -3, 44,</div>
<div class="line">     93, 139, 182, 219, 249, 269, 280, 279, 267, 243, 208, 164, 110, 50,</div>
<div class="line">     -13, -80, -146, -209, -266, -314, -352, -376, -386, -380, -359,</div>
<div class="line">     -322, -270, -205, -128, -44, 45, 137, 227, 311, 386, 449, 495, 523,</div>
<div class="line">     530, 516, 480, 423, 346, 252, 144, 25, -99, -225, -347, -460, -558,</div>
<div class="line">     -637, -694, -724, -726, -698, -640, -553, -440, -305, -151, 15, 187,</div>
<div class="line">     359, 524, 673, 801, 902, 969, 999, 990, 939, 848, 718, 554, 359,</div>
<div class="line">     142, -89, -327, -561, -782, -980, -1145, -1271, -1349, -1375, -1346,</div>
<div class="line">     -1260, -1118, -925, -686, -409, -104, 218, 544, 862, 1157, 1417,</div>
<div class="line">     1629, 1784, 1871, 1885, 1822, 1681, 1466, 1181, 836, 443, 15, -430,</div>
<div class="line">     -877, -1306, -1700, -2039, -2309, -2495, -2586, -2575, -2457, -2233,</div>
<div class="line">     -1909, -1492, -997, -441, 156, 771, 1381, 1958, 2479, 2920, 3259,</div>
<div class="line">     3478, 3562, 3504, 3300, 2951, 2467, 1861, 1154, 371, -460, -1306,</div>
<div class="line">     -2134, -2908, -3595, -4162, -4582, -4830, -4890, -4752, -4413,</div>
<div class="line">     -3878, -3162, -2286, -1281, -181, 971, 2131, 3252, 4285, 5184, 5908,</div>
<div class="line">     6418, 6686, 6690, 6419, 5874, 5064, 4013, 2753, 1329, -208, -1801,</div>
<div class="line">     -3385, -4896, -6268, -7438, -8351, -8959, -9223, -9120, -8637,</div>
<div class="line">     -7779, -6566, -5034, -3231, -1221, 921, 3114, 5270, 7298, 9110,</div>
<div class="line">     10622, 11760, 12462, 12680, 12386, 11571, 10247, 8447, 6225, 3657,</div>
<div class="line">     832, -2143, -5153, -8076, -10787, -13167, -15103, -16499, -17274,</div>
<div class="line">     -17372, -16759, -15432, -13417, -10766, -7564, -3920, 36, 4153, 8270,</div>
<div class="line">     12217, 15825, 18930, 21386, 23065, 23864, 23716, 22587, 20483, 17450,</div>
<div class="line">     13576, 8983, 3832, -1687, -7367, -12977, -18286, -23061, -27086,</div>
<div class="line">     -30164, -32129, -32855, -32260, -30315, -27044, -22526, -16897,</div>
<div class="line">     -10341, -3089, 4587, 12392, 20010, 27120, 33408, 38583, 42385, 44602,</div>
<div class="line">     45078, 43720, 40510, 35502, 28830, 20697, 11378, 1207, -9432, -20123,</div>
<div class="line">     -30427, -39906, -48136, -54727, -59340, -61705, -61632, -59023,</div>
<div class="line">     -53880, -46311, -36527, -24838, -11646, 2567, 17262, 31853, 45737,</div>
<div class="line">     58314, 69012, 77316, 82784, 85076, 83966, 79360, 71301, 59981, 45728,</div>
<div class="line">     29009, 10408, -9387, -29613, -49456, -68085, -84684, -98487, -108811,</div>
<div class="line">     -115090, -116897, -113975, -106249, -93837, -77057, -56418, -32610,</div>
<div class="line">     -6480, 20993, 48737, 75622, 100508, 122289, 139942, 152573, 159453,</div>
<div class="line">     160065, 154123, 141602, 122746, 98068, 68342, 34581, -1992, -39992,</div>
<div class="line">     -77915, -114200, -147287, -175686, -198036, -213168, -220164,</div>
<div class="line">     -218401, -207588, -187799, -159476};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">char</span> *textdata =</div>
<div class="line">    <span class="stringliteral">&quot;I&#39;ve seen things you people wouldn&#39;t believe. Attack ships on fire off the shoulder of Orion. &quot;</span></div>
<div class="line">    <span class="stringliteral">&quot;I watched C-beams glitter in the dark near the Tannhäuser Gate. All those moments will be lost &quot;</span></div>
<div class="line">    <span class="stringliteral">&quot;in time, like tears...in...rain. Time to die.&quot;</span>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Binary I/O for Windows platforms */</span></div>
<div class="line"><span class="preprocessor">#ifdef LMP_WIN</span></div>
<div class="line"><span class="preprocessor">  #include &lt;fcntl.h&gt;</span></div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> _CRT_fmode = _O_BINARY;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span></div>
<div class="line">main (<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)</div>
<div class="line">{</div>
<div class="line">  <a class="code hl_struct" href="group__miniseed-record.html#struct_m_s3_record">MS3Record</a> *msr = NULL;</div>
<div class="line">  <span class="keywordtype">float</span> *fdata  = NULL;</div>
<div class="line">  <span class="keywordtype">double</span> *ddata = NULL;</div>
<div class="line">  uint32_t flags = 0;</div>
<div class="line">  <span class="keywordtype">int</span> idx;</div>
<div class="line">  <span class="keywordtype">int</span> rv;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* Redirect libmseed logging facility to stderr for consistency */</span></div>
<div class="line">  <a class="code hl_define" href="group__logging.html#gaef42fde6881f3779eb6cd951da22da2b">ms_loginit</a> (print_stderr, NULL, print_stderr, NULL);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* Process command line arguments */</span></div>
<div class="line">  <span class="keywordflow">if</span> (parameter_proc (argc, argv) &lt; 0)</div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (!(msr = <a class="code hl_function" href="group__miniseed-record.html#ga45b12b97428e86249ee371ca0fd61473">msr3_init</a> (msr)))</div>
<div class="line">  {</div>
<div class="line">    fprintf (stderr, <span class="stringliteral">&quot;Could not allocate MS3Record, out of memory?\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span> 1;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* Set up record parameters */</span></div>
<div class="line">  strcpy (msr-&gt;<a class="code hl_variable" href="group__miniseed-record.html#ac93add454993eff521bc94900bf40ac1">sid</a>, <span class="stringliteral">&quot;XFDSN:XX_TEST__L_H_Z&quot;</span>);</div>
<div class="line">  msr-&gt;<a class="code hl_variable" href="group__miniseed-record.html#a47d7e72d144305b788d69e3ba859f087">reclen</a> = reclen;</div>
<div class="line">  msr-&gt;<a class="code hl_variable" href="group__miniseed-record.html#aef0f37c7df7a014ff18c123187cda1b6">pubversion</a> = 1;</div>
<div class="line">  msr-&gt;<a class="code hl_variable" href="group__miniseed-record.html#a8ed5d39b9df3bfa9dd953c33d27ac73e">starttime</a> = <a class="code hl_function" href="group__time-related.html#ga5970fa0256338e4964e25941eac6c01e">ms_timestr2nstime</a> (<span class="stringliteral">&quot;2012-01-01T00:00:00&quot;</span>);</div>
<div class="line">  msr-&gt;<a class="code hl_variable" href="group__miniseed-record.html#a7578e312e666fcc80cc07fd324201d4e">samprate</a> = 1.0;</div>
<div class="line">  msr-&gt;<a class="code hl_variable" href="group__miniseed-record.html#a63ee8e965be55863765c56016873be17">encoding</a> = encoding;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (encoding == <a class="code hl_define" href="group__encoding-values.html#ga0e4d3b0ef76ca9b3e19b2b9f597bc539">DE_ASCII</a>)</div>
<div class="line">  {</div>
<div class="line">    msr-&gt;<a class="code hl_variable" href="group__miniseed-record.html#a7871a3c78d7ecb7c30c6526aa1fd9718">numsamples</a>  = strlen (textdata);</div>
<div class="line">    msr-&gt;<a class="code hl_variable" href="group__miniseed-record.html#a1c3a46dfc681da1bf5199b48bf9c55d3">datasamples</a> = textdata;</div>
<div class="line">    msr-&gt;<a class="code hl_variable" href="group__miniseed-record.html#a866a8640500756bc031ef7897fc1eeb2">sampletype</a>  = <span class="charliteral">&#39;a&#39;</span>;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (encoding == <a class="code hl_define" href="group__encoding-values.html#ga131dc4aeb13edcbd54dc80f14315cb28">DE_FLOAT32</a>)</div>
<div class="line">  {</div>
<div class="line">    msr-&gt;<a class="code hl_variable" href="group__miniseed-record.html#a7871a3c78d7ecb7c30c6526aa1fd9718">numsamples</a> = 500;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (!(fdata = (<span class="keywordtype">float</span> *)malloc (msr-&gt;<a class="code hl_variable" href="group__miniseed-record.html#a7871a3c78d7ecb7c30c6526aa1fd9718">numsamples</a> * sizeof (<span class="keywordtype">float</span>))))</div>
<div class="line">    {</div>
<div class="line">      fprintf (stderr, <span class="stringliteral">&quot;Could not allocate buffer, out of memory?\n&quot;</span>);</div>
<div class="line">      <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">for</span> (idx = 0; idx &lt; msr-&gt;<a class="code hl_variable" href="group__miniseed-record.html#a7871a3c78d7ecb7c30c6526aa1fd9718">numsamples</a>; idx++)</div>
<div class="line">    {</div>
<div class="line">      fdata[idx] = (float)sindata[idx];</div>
<div class="line">    }</div>
<div class="line">    msr-&gt;<a class="code hl_variable" href="group__miniseed-record.html#a1c3a46dfc681da1bf5199b48bf9c55d3">datasamples</a> = fdata;</div>
<div class="line">    msr-&gt;<a class="code hl_variable" href="group__miniseed-record.html#a866a8640500756bc031ef7897fc1eeb2">sampletype</a>  = <span class="charliteral">&#39;f&#39;</span>;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (encoding == <a class="code hl_define" href="group__encoding-values.html#ga25685778ab9a5295f3f15313f515820b">DE_FLOAT64</a>)</div>
<div class="line">  {</div>
<div class="line">    msr-&gt;<a class="code hl_variable" href="group__miniseed-record.html#a7871a3c78d7ecb7c30c6526aa1fd9718">numsamples</a> = 500;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (!(ddata = (<span class="keywordtype">double</span> *)malloc (msr-&gt;<a class="code hl_variable" href="group__miniseed-record.html#a7871a3c78d7ecb7c30c6526aa1fd9718">numsamples</a> * sizeof (<span class="keywordtype">double</span>))))</div>
<div class="line">    {</div>
<div class="line">      fprintf (stderr, <span class="stringliteral">&quot;Could not allocate buffer, out of memory?\n&quot;</span>);</div>
<div class="line">      <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">for</span> (idx = 0; idx &lt; msr-&gt;<a class="code hl_variable" href="group__miniseed-record.html#a7871a3c78d7ecb7c30c6526aa1fd9718">numsamples</a>; idx++)</div>
<div class="line">    {</div>
<div class="line">      ddata[idx] = (double)sindata[idx];</div>
<div class="line">    }</div>
<div class="line">    msr-&gt;<a class="code hl_variable" href="group__miniseed-record.html#a1c3a46dfc681da1bf5199b48bf9c55d3">datasamples</a> = ddata;</div>
<div class="line">    msr-&gt;<a class="code hl_variable" href="group__miniseed-record.html#a866a8640500756bc031ef7897fc1eeb2">sampletype</a>  = <span class="charliteral">&#39;d&#39;</span>;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (encoding == <a class="code hl_define" href="group__encoding-values.html#gab435f469f14c9423949f7faa644f3830">DE_INT16</a>)</div>
<div class="line">  {</div>
<div class="line">    msr-&gt;<a class="code hl_variable" href="group__miniseed-record.html#a7871a3c78d7ecb7c30c6526aa1fd9718">numsamples</a>  = 400; <span class="comment">/* The first 400 samples can be represented in 16-bits */</span></div>
<div class="line">    msr-&gt;<a class="code hl_variable" href="group__miniseed-record.html#a1c3a46dfc681da1bf5199b48bf9c55d3">datasamples</a> = sindata;</div>
<div class="line">    msr-&gt;<a class="code hl_variable" href="group__miniseed-record.html#a866a8640500756bc031ef7897fc1eeb2">sampletype</a>  = <span class="charliteral">&#39;i&#39;</span>;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">else</span></div>
<div class="line">  {</div>
<div class="line">    msr-&gt;<a class="code hl_variable" href="group__miniseed-record.html#a7871a3c78d7ecb7c30c6526aa1fd9718">numsamples</a>  = 500;</div>
<div class="line">    msr-&gt;<a class="code hl_variable" href="group__miniseed-record.html#a1c3a46dfc681da1bf5199b48bf9c55d3">datasamples</a> = sindata;</div>
<div class="line">    msr-&gt;<a class="code hl_variable" href="group__miniseed-record.html#a866a8640500756bc031ef7897fc1eeb2">sampletype</a>  = <span class="charliteral">&#39;i&#39;</span>;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  msr-&gt;<a class="code hl_variable" href="group__miniseed-record.html#a85d0d5f365d50df0490d944dffdb3853">samplecnt</a> = msr-&gt;<a class="code hl_variable" href="group__miniseed-record.html#a7871a3c78d7ecb7c30c6526aa1fd9718">numsamples</a>;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* Set data flush flag */</span></div>
<div class="line">  flags |= <a class="code hl_define" href="group__control-flags.html#gaae2d9bb856575a556a4ac4dd1ce5f8c5">MSF_FLUSHDATA</a>;</div>
<div class="line"> </div>
<div class="line">  rv = <a class="code hl_function" href="group__io-functions.html#gaf2d6e0ee8e0cdc39add72816ca56ce4c">msr3_writemseed</a> (msr, outfile, 1, flags, verbose);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (rv &lt; 0)</div>
<div class="line">    <a class="code hl_define" href="group__logging.html#ga2d51fa9deb29995ef93287db5e7b11c4">ms_log</a> (2, <span class="stringliteral">&quot;Error (%d) writing miniSEED to %s\n&quot;</span>, rv, outfile);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* Make sure everything is cleaned up */</span></div>
<div class="line">  <span class="keywordflow">if</span> (msr-&gt;<a class="code hl_variable" href="group__miniseed-record.html#a1c3a46dfc681da1bf5199b48bf9c55d3">datasamples</a> == sindata || msr-&gt;<a class="code hl_variable" href="group__miniseed-record.html#a1c3a46dfc681da1bf5199b48bf9c55d3">datasamples</a> == textdata)</div>
<div class="line">    msr-&gt;<a class="code hl_variable" href="group__miniseed-record.html#a1c3a46dfc681da1bf5199b48bf9c55d3">datasamples</a> = NULL;</div>
<div class="line">  <a class="code hl_function" href="group__miniseed-record.html#ga72e0d55e9200bbdda71d157cd8939d4e">msr3_free</a> (&amp;msr);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">} <span class="comment">/* End of main() */</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/***************************************************************************</span></div>
<div class="line"><span class="comment"> * parameter_proc:</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Process the command line arguments.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Returns 0 on success, and -1 on failure</span></div>
<div class="line"><span class="comment"> ***************************************************************************/</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">parameter_proc (<span class="keywordtype">int</span> argcount, <span class="keywordtype">char</span> **argvec)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">int</span> optind;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* Process all command line arguments */</span></div>
<div class="line">  <span class="keywordflow">for</span> (optind = 1; optind &lt; argcount; optind++)</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordflow">if</span> (strcmp (argvec[optind], <span class="stringliteral">&quot;-V&quot;</span>) == 0)</div>
<div class="line">    {</div>
<div class="line">      <a class="code hl_define" href="group__logging.html#ga2d51fa9deb29995ef93287db5e7b11c4">ms_log</a> (1, <span class="stringliteral">&quot;%s version: %s\n&quot;</span>, PACKAGE, VERSION);</div>
<div class="line">      exit (0);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp (argvec[optind], <span class="stringliteral">&quot;-h&quot;</span>) == 0)</div>
<div class="line">    {</div>
<div class="line">      usage ();</div>
<div class="line">      exit (0);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strncmp (argvec[optind], <span class="stringliteral">&quot;-v&quot;</span>, 2) == 0)</div>
<div class="line">    {</div>
<div class="line">      verbose += strspn (&amp;argvec[optind][1], <span class="stringliteral">&quot;v&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp (argvec[optind], <span class="stringliteral">&quot;-r&quot;</span>) == 0)</div>
<div class="line">    {</div>
<div class="line">      reclen = strtol (argvec[++optind], NULL, 10);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp (argvec[optind], <span class="stringliteral">&quot;-e&quot;</span>) == 0)</div>
<div class="line">    {</div>
<div class="line">      encoding = strtol (argvec[++optind], NULL, 10);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp (argvec[optind], <span class="stringliteral">&quot;-b&quot;</span>) == 0)</div>
<div class="line">    {</div>
<div class="line">      byteorder = strtol (argvec[++optind], NULL, 10);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp (argvec[optind], <span class="stringliteral">&quot;-o&quot;</span>) == 0)</div>
<div class="line">    {</div>
<div class="line">      outfile = argvec[++optind];</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line">      <a class="code hl_define" href="group__logging.html#ga2d51fa9deb29995ef93287db5e7b11c4">ms_log</a> (2, <span class="stringliteral">&quot;Unknown option: %s\n&quot;</span>, argvec[optind]);</div>
<div class="line">      exit (1);</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* Make sure an outfile was specified */</span></div>
<div class="line">  <span class="keywordflow">if</span> (!outfile)</div>
<div class="line">  {</div>
<div class="line">    <a class="code hl_define" href="group__logging.html#ga2d51fa9deb29995ef93287db5e7b11c4">ms_log</a> (2, <span class="stringliteral">&quot;No output file was specified\n\n&quot;</span>);</div>
<div class="line">    <a class="code hl_define" href="group__logging.html#ga2d51fa9deb29995ef93287db5e7b11c4">ms_log</a> (1, <span class="stringliteral">&quot;Try %s -h for usage\n&quot;</span>, PACKAGE);</div>
<div class="line">    exit (1);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* Report the program version */</span></div>
<div class="line">  <span class="keywordflow">if</span> (verbose)</div>
<div class="line">    <a class="code hl_define" href="group__logging.html#ga2d51fa9deb29995ef93287db5e7b11c4">ms_log</a> (1, <span class="stringliteral">&quot;%s version: %s\n&quot;</span>, PACKAGE, VERSION);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">} <span class="comment">/* End of parameter_proc() */</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/***************************************************************************</span></div>
<div class="line"><span class="comment"> * print_stderr():</span></div>
<div class="line"><span class="comment"> * Print messsage to stderr.</span></div>
<div class="line"><span class="comment"> ***************************************************************************/</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">print_stderr (<span class="keyword">const</span> <span class="keywordtype">char</span> *message)</div>
<div class="line">{</div>
<div class="line">  fprintf (stderr, <span class="stringliteral">&quot;%s&quot;</span>, message);</div>
<div class="line">} <span class="comment">/* End of print_stderr() */</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/***************************************************************************</span></div>
<div class="line"><span class="comment"> * usage:</span></div>
<div class="line"><span class="comment"> * Print the usage message and exit.</span></div>
<div class="line"><span class="comment"> ***************************************************************************/</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">usage (<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">  fprintf (stderr, <span class="stringliteral">&quot;%s version: %s\n\n&quot;</span>, PACKAGE, VERSION);</div>
<div class="line">  fprintf (stderr, <span class="stringliteral">&quot;Usage: %s [options] -o outfile\n\n&quot;</span>, PACKAGE);</div>
<div class="line">  fprintf (stderr,</div>
<div class="line">           <span class="stringliteral">&quot; ## Options ##\n&quot;</span></div>
<div class="line">           <span class="stringliteral">&quot; -V             Report program version\n&quot;</span></div>
<div class="line">           <span class="stringliteral">&quot; -h             Show this usage message\n&quot;</span></div>
<div class="line">           <span class="stringliteral">&quot; -v             Be more verbose, multiple flags can be used\n&quot;</span></div>
<div class="line">           <span class="stringliteral">&quot; -r bytes       Specify maximum record length in bytes, default 4096\n&quot;</span></div>
<div class="line">           <span class="stringliteral">&quot; -e encoding    Specify encoding format\n&quot;</span></div>
<div class="line">           <span class="stringliteral">&quot; -b byteorder   Specify byte order for packing, MSBF: 1, LSBF: 0\n&quot;</span></div>
<div class="line">           <span class="stringliteral">&quot;\n&quot;</span></div>
<div class="line">           <span class="stringliteral">&quot; -o outfile     Specify the output file, required\n&quot;</span></div>
<div class="line">           <span class="stringliteral">&quot;\n&quot;</span></div>
<div class="line">           <span class="stringliteral">&quot;This program packs static, test data into miniSEED\n&quot;</span></div>
<div class="line">           <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line">} <span class="comment">/* End of usage() */</span></div>
<div class="ttc" id="agroup__control-flags_html_gaae2d9bb856575a556a4ac4dd1ce5f8c5"><div class="ttname"><a href="group__control-flags.html#gaae2d9bb856575a556a4ac4dd1ce5f8c5">MSF_FLUSHDATA</a></div><div class="ttdeci">#define MSF_FLUSHDATA</div><div class="ttdoc">[Packing] Pack all available data even if final record would not be filled</div><div class="ttdef"><b>Definition:</b> libmseed.h:1350</div></div>
<div class="ttc" id="agroup__encoding-values_html_ga0e4d3b0ef76ca9b3e19b2b9f597bc539"><div class="ttname"><a href="group__encoding-values.html#ga0e4d3b0ef76ca9b3e19b2b9f597bc539">DE_ASCII</a></div><div class="ttdeci">#define DE_ASCII</div><div class="ttdoc">ASCII (text) encoding.</div><div class="ttdef"><b>Definition:</b> libmseed.h:1296</div></div>
<div class="ttc" id="agroup__encoding-values_html_ga131dc4aeb13edcbd54dc80f14315cb28"><div class="ttname"><a href="group__encoding-values.html#ga131dc4aeb13edcbd54dc80f14315cb28">DE_FLOAT32</a></div><div class="ttdeci">#define DE_FLOAT32</div><div class="ttdoc">32-bit float (IEEE)</div><div class="ttdef"><b>Definition:</b> libmseed.h:1299</div></div>
<div class="ttc" id="agroup__encoding-values_html_ga25685778ab9a5295f3f15313f515820b"><div class="ttname"><a href="group__encoding-values.html#ga25685778ab9a5295f3f15313f515820b">DE_FLOAT64</a></div><div class="ttdeci">#define DE_FLOAT64</div><div class="ttdoc">64-bit float (IEEE)</div><div class="ttdef"><b>Definition:</b> libmseed.h:1300</div></div>
<div class="ttc" id="agroup__encoding-values_html_gab435f469f14c9423949f7faa644f3830"><div class="ttname"><a href="group__encoding-values.html#gab435f469f14c9423949f7faa644f3830">DE_INT16</a></div><div class="ttdeci">#define DE_INT16</div><div class="ttdoc">16-bit integer</div><div class="ttdef"><b>Definition:</b> libmseed.h:1297</div></div>
<div class="ttc" id="agroup__io-functions_html_gaf2d6e0ee8e0cdc39add72816ca56ce4c"><div class="ttname"><a href="group__io-functions.html#gaf2d6e0ee8e0cdc39add72816ca56ce4c">msr3_writemseed</a></div><div class="ttdeci">int64_t msr3_writemseed(MS3Record *msr, const char *mspath, int8_t overwrite, uint32_t flags, int8_t verbose)</div><div class="ttdoc">Write miniSEED from an MS3Record container to a file.</div><div class="ttdef"><b>Definition:</b> fileutils.c:886</div></div>
<div class="ttc" id="agroup__logging_html_gaef42fde6881f3779eb6cd951da22da2b"><div class="ttname"><a href="group__logging.html#gaef42fde6881f3779eb6cd951da22da2b">ms_loginit</a></div><div class="ttdeci">#define ms_loginit(log_print, logprefix, diag_print, errprefix)</div><div class="ttdoc">Convenience wrapper for ms_rloginit(), omitting max messages, disabling registry.</div><div class="ttdef"><b>Definition:</b> libmseed.h:1106</div></div>
<div class="ttc" id="agroup__miniseed-record_html_a47d7e72d144305b788d69e3ba859f087"><div class="ttname"><a href="group__miniseed-record.html#a47d7e72d144305b788d69e3ba859f087">MS3Record::reclen</a></div><div class="ttdeci">int32_t reclen</div><div class="ttdoc">Length of miniSEED record in bytes.</div><div class="ttdef"><b>Definition:</b> libmseed.h:325</div></div>
<div class="ttc" id="agroup__miniseed-record_html_a7578e312e666fcc80cc07fd324201d4e"><div class="ttname"><a href="group__miniseed-record.html#a7578e312e666fcc80cc07fd324201d4e">MS3Record::samprate</a></div><div class="ttdeci">double samprate</div><div class="ttdoc">Nominal sample rate as samples/second (Hz) or period (s)</div><div class="ttdef"><b>Definition:</b> libmseed.h:333</div></div>
<div class="ttc" id="agroup__miniseed-record_html_ac93add454993eff521bc94900bf40ac1"><div class="ttname"><a href="group__miniseed-record.html#ac93add454993eff521bc94900bf40ac1">MS3Record::sid</a></div><div class="ttdeci">char sid[LM_SIDLEN]</div><div class="ttdoc">Source identifier as URN, max length LM_SIDLEN.</div><div class="ttdef"><b>Definition:</b> libmseed.h:329</div></div>
<div class="ttc" id="agroup__miniseed-record_html_aef0f37c7df7a014ff18c123187cda1b6"><div class="ttname"><a href="group__miniseed-record.html#aef0f37c7df7a014ff18c123187cda1b6">MS3Record::pubversion</a></div><div class="ttdeci">uint8_t pubversion</div><div class="ttdoc">Publication version.</div><div class="ttdef"><b>Definition:</b> libmseed.h:335</div></div>
<div class="ttc" id="agroup__miniseed-record_html_ga45b12b97428e86249ee371ca0fd61473"><div class="ttname"><a href="group__miniseed-record.html#ga45b12b97428e86249ee371ca0fd61473">msr3_init</a></div><div class="ttdeci">MS3Record * msr3_init(MS3Record *msr)</div><div class="ttdoc">Initialize and return an MS3Record.</div><div class="ttdef"><b>Definition:</b> msrutils.c:44</div></div>
<div class="ttc" id="agroup__miniseed-record_html_ga72e0d55e9200bbdda71d157cd8939d4e"><div class="ttname"><a href="group__miniseed-record.html#ga72e0d55e9200bbdda71d157cd8939d4e">msr3_free</a></div><div class="ttdeci">void msr3_free(MS3Record **ppmsr)</div><div class="ttdoc">Free all memory associated with a MS3Record.</div><div class="ttdef"><b>Definition:</b> msrutils.c:89</div></div>
<div class="ttc" id="agroup__time-related_html_ga5970fa0256338e4964e25941eac6c01e"><div class="ttname"><a href="group__time-related.html#ga5970fa0256338e4964e25941eac6c01e">ms_timestr2nstime</a></div><div class="ttdeci">nstime_t ms_timestr2nstime(const char *timestr)</div><div class="ttdoc">Convert a time string to a high precision epoch time.</div><div class="ttdef"><b>Definition:</b> genutils.c:1218</div></div>
<div class="ttc" id="alibmseed_8h_html_a2fa2d4ca679cdb79cfa01c1cc94a7298"><div class="ttname"><a href="libmseed_8h.html#a2fa2d4ca679cdb79cfa01c1cc94a7298">flag</a></div><div class="ttdeci">int8_t flag</div><div class="ttdef"><b>Definition:</b> libmseed.h:1229</div></div>
</div><!-- fragment --><h1><a class="anchor" id="example-lm_pack_rollingbuffer"></a>
Writing miniSEED with rolling buffer</h1>
<p >An example of creating miniSEED using a <a class="el" href="group__trace-list.html#struct_m_s3_trace_list" title="Container for a collection of continuous trace segment, linkable.">MS3TraceList</a> as a rolling buffer of data. This pattern is useful for generating miniSEED in a streaming fashion for scenarios where holding all data in memory is not possible or practical. For example, very large data sets or continuous, streaming data.</p>
<p >An input file of miniSEED is used as a convenient data source. <a class="el" href="group__miniseed-record.html#struct_m_s3_record" title="miniSEED record container">MS3Record</a> containers can be constructed for any arbitrary data and follow the same pattern of record generation.</p>
<div class="fragment"><div class="line"><span class="comment">/***************************************************************************</span></div>
<div class="line"><span class="comment"> * A program for illustrating the use of a Trace List as an</span></div>
<div class="line"><span class="comment"> * intermediate, rolling buffer for production of data records.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * An input file of miniSEED is used as a convenient data source.</span></div>
<div class="line"><span class="comment"> * MS3Records can be constructed for any arbitrary data and follow the</span></div>
<div class="line"><span class="comment"> * same pattern of record generation.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * This file is part of the miniSEED Library.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Copyright (c) 2020 Chad Trabant, IRIS Data Management Center</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span></div>
<div class="line"><span class="comment"> * you may not use this file except in compliance with the License.</span></div>
<div class="line"><span class="comment"> * You may obtain a copy of the License at</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *   http://www.apache.org/licenses/LICENSE-2.0</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Unless required by applicable law or agreed to in writing, software</span></div>
<div class="line"><span class="comment"> * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></div>
<div class="line"><span class="comment"> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></div>
<div class="line"><span class="comment"> * See the License for the specific language governing permissions and</span></div>
<div class="line"><span class="comment"> * limitations under the License.</span></div>
<div class="line"><span class="comment"> ***************************************************************************/</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sys/stat.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;errno.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="libmseed_8h.html">libmseed.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/***************************************************************************</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * A simple record handler callback function that parses and prints records</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> ***************************************************************************/</span></div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line">record_handler (<span class="keywordtype">char</span> *record, <span class="keywordtype">int</span> reclen, <span class="keywordtype">void</span> *handlerdata)</div>
<div class="line">{</div>
<div class="line">  <a class="code hl_struct" href="group__miniseed-record.html#struct_m_s3_record">MS3Record</a> *msr = NULL;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (!<a class="code hl_function" href="group__miniseed-record.html#ga685b3796656bcf24c2f417c94d3631f6">msr3_parse</a> (record, reclen, &amp;msr, 0, 0))</div>
<div class="line">  {</div>
<div class="line">    <a class="code hl_function" href="group__miniseed-record.html#gaad6b4c5c5194d338f9d89dfe84b44bd9">msr3_print</a> (msr, 0);</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">else</span></div>
<div class="line">  {</div>
<div class="line">    fprintf (stderr, <span class="stringliteral">&quot;%s() Error parsing record\n&quot;</span>, __func__);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_function" href="group__miniseed-record.html#ga72e0d55e9200bbdda71d157cd8939d4e">msr3_free</a> (&amp;msr);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span></div>
<div class="line">main (<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)</div>
<div class="line">{</div>
<div class="line">  <a class="code hl_struct" href="group__miniseed-record.html#struct_m_s3_record">MS3Record</a> *msr = NULL;</div>
<div class="line">  <a class="code hl_struct" href="group__trace-list.html#struct_m_s3_trace_list">MS3TraceList</a> *mstl = NULL;</div>
<div class="line">  <span class="keywordtype">char</span> *inputfile = NULL;</div>
<div class="line">  uint32_t flags = 0;</div>
<div class="line">  int8_t verbose = 0;</div>
<div class="line">  <span class="keywordtype">int</span> retcode;</div>
<div class="line"> </div>
<div class="line">  int64_t psamples;</div>
<div class="line">  <span class="keywordtype">int</span> precords;</div>
<div class="line">  <span class="keywordtype">int</span> reclen = 256; <span class="comment">/* Desired maximum record length */</span></div>
<div class="line">  uint8_t encoding = <a class="code hl_define" href="group__encoding-values.html#ga88038a2002e473c74440f7fae5f0dc74">DE_STEIM2</a>; <span class="comment">/* Desired data encoding */</span></div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (argc != 2)</div>
<div class="line">  {</div>
<div class="line">    <a class="code hl_define" href="group__logging.html#ga2d51fa9deb29995ef93287db5e7b11c4">ms_log</a> (2, <span class="stringliteral">&quot;Usage: %s &lt;mseedfile&gt;\n&quot;</span>, argv[0]);</div>
<div class="line">    <span class="keywordflow">return</span> 1;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  inputfile = argv[1];</div>
<div class="line"> </div>
<div class="line">  mstl = <a class="code hl_function" href="group__trace-list.html#gac23dc184eac5bbfec546e1079ea4aed7">mstl3_init</a>(NULL);</div>
<div class="line">  <span class="keywordflow">if</span> (mstl == NULL)</div>
<div class="line">  {</div>
<div class="line">    <a class="code hl_define" href="group__logging.html#ga2d51fa9deb29995ef93287db5e7b11c4">ms_log</a> (2, <span class="stringliteral">&quot;Cannot allocate memory\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span> 1;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* Set bit flags to validate CRC and unpack data samples */</span></div>
<div class="line">  flags |= <a class="code hl_define" href="group__control-flags.html#gab06edaad68767eb4f5603d3fcb3eeb13">MSF_VALIDATECRC</a>;</div>
<div class="line">  flags |= <a class="code hl_define" href="group__control-flags.html#ga95033e92e20f803ae8e3daebca1a2b5b">MSF_UNPACKDATA</a>;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* Loop over the input file as a source of data */</span></div>
<div class="line">  <span class="keywordflow">while</span> ((retcode = <a class="code hl_function" href="group__io-functions.html#ga120eaddf0e86963ad6764899b3783cad">ms3_readmsr</a> (&amp;msr, inputfile, NULL, NULL, flags,</div>
<div class="line">                                 verbose)) == <a class="code hl_define" href="group__return-values.html#ga91727033ca93e4d2b47ecb80243b054d">MS_NOERROR</a>)</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code hl_define" href="group__trace-list.html#ga9f56917332e05aa2e22c167014f9efed">mstl3_addmsr</a> (mstl, msr, 0, 1, flags, NULL) == NULL)</div>
<div class="line">    {</div>
<div class="line">      <a class="code hl_define" href="group__logging.html#ga2d51fa9deb29995ef93287db5e7b11c4">ms_log</a> (2, <span class="stringliteral">&quot;mstl2_addmsr() had problems\n&quot;</span>);</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Attempt to pack data in the Trace List buffer.</span></div>
<div class="line"><span class="comment">     * Only filled, or complete, records will be generated. */</span></div>
<div class="line"> </div>
<div class="line">    <a class="code hl_define" href="group__logging.html#ga2d51fa9deb29995ef93287db5e7b11c4">ms_log</a> (0, <span class="stringliteral">&quot;Calling mstl3_pack() to generate records\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    precords = <a class="code hl_function" href="group__trace-list.html#ga28697b648a1390ae480fdcf75a478079">mstl3_pack</a> (mstl,           <span class="comment">// Pack data in this trace list</span></div>
<div class="line">                           record_handler, <span class="comment">// Callback function that will handle records</span></div>
<div class="line">                           NULL,           <span class="comment">// Callback function data, none in this case</span></div>
<div class="line">                           reclen,         <span class="comment">// Maximum record length</span></div>
<div class="line">                           encoding,       <span class="comment">// Data encoding</span></div>
<div class="line">                           &amp;psamples,      <span class="comment">// Packed sample count</span></div>
<div class="line">                           flags,          <span class="comment">// Flags to control packing</span></div>
<div class="line">                           verbose,        <span class="comment">// Verbosity</span></div>
<div class="line">                           NULL            <span class="comment">// Extra headers to inject, none in this case</span></div>
<div class="line">    );</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_define" href="group__logging.html#ga2d51fa9deb29995ef93287db5e7b11c4">ms_log</a> (0, <span class="stringliteral">&quot;mstl3_pack() created %d records containing %&quot;</span> PRId64 <span class="stringliteral">&quot; samples\n&quot;</span>,</div>
<div class="line">            precords, psamples);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (retcode != <a class="code hl_define" href="group__return-values.html#gaaa6856cc106d8dcd273bdaa7a48082d0">MS_ENDOFFILE</a>)</div>
<div class="line">    <a class="code hl_define" href="group__logging.html#ga2d51fa9deb29995ef93287db5e7b11c4">ms_log</a> (2, <span class="stringliteral">&quot;Error reading %s: %s\n&quot;</span>, inputfile, <a class="code hl_function" href="group__utility-functions.html#gac7d8c8a631b2d333da3246610b75f079">ms_errorstr</a> (retcode));</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* Final call to flush data buffers, adding MSF_FLUSHDATA flag */</span></div>
<div class="line">  <a class="code hl_define" href="group__logging.html#ga2d51fa9deb29995ef93287db5e7b11c4">ms_log</a> (0, <span class="stringliteral">&quot;Calling mstl3_pack() with MSF_FLUSHDATA flag\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  precords = <a class="code hl_function" href="group__trace-list.html#ga28697b648a1390ae480fdcf75a478079">mstl3_pack</a> (mstl,                    <span class="comment">// Pack data in this trace list</span></div>
<div class="line">                         record_handler,          <span class="comment">// Callback function that will handle records</span></div>
<div class="line">                         NULL,                    <span class="comment">// Callback function data, none in this case</span></div>
<div class="line">                         reclen,                  <span class="comment">// Maximum record length</span></div>
<div class="line">                         encoding,                <span class="comment">// Data encoding</span></div>
<div class="line">                         &amp;psamples,               <span class="comment">// Packed sample count</span></div>
<div class="line">                         (flags | <a class="code hl_define" href="group__control-flags.html#gaae2d9bb856575a556a4ac4dd1ce5f8c5">MSF_FLUSHDATA</a>), <span class="comment">// Flags to control packing, adding flush flag</span></div>
<div class="line">                         verbose,                 <span class="comment">// Verbosity</span></div>
<div class="line">                         NULL                     <span class="comment">// Extra headers to inject, none in this case</span></div>
<div class="line">  );</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_define" href="group__logging.html#ga2d51fa9deb29995ef93287db5e7b11c4">ms_log</a> (0, <span class="stringliteral">&quot;Final mstl3_pack() created %d records containing %&quot;</span> PRId64 <span class="stringliteral">&quot; samples\n&quot;</span>,</div>
<div class="line">          precords, psamples);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* Make sure everything is cleaned up */</span></div>
<div class="line">  <span class="keywordflow">if</span> (msr)</div>
<div class="line">    <a class="code hl_function" href="group__miniseed-record.html#ga72e0d55e9200bbdda71d157cd8939d4e">msr3_free</a> (&amp;msr);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (mstl)</div>
<div class="line">    <a class="code hl_function" href="group__trace-list.html#ga2a436ab4eb7cd653e52e6760c2f51f20">mstl3_free</a> (&amp;mstl, 0);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="agroup__encoding-values_html_ga88038a2002e473c74440f7fae5f0dc74"><div class="ttname"><a href="group__encoding-values.html#ga88038a2002e473c74440f7fae5f0dc74">DE_STEIM2</a></div><div class="ttdeci">#define DE_STEIM2</div><div class="ttdoc">Steim-2 compressed integers.</div><div class="ttdef"><b>Definition:</b> libmseed.h:1302</div></div>
<div class="ttc" id="agroup__miniseed-record_html_ga685b3796656bcf24c2f417c94d3631f6"><div class="ttname"><a href="group__miniseed-record.html#ga685b3796656bcf24c2f417c94d3631f6">msr3_parse</a></div><div class="ttdeci">int msr3_parse(char *record, uint64_t recbuflen, MS3Record **ppmsr, uint32_t flags, int8_t verbose)</div><div class="ttdoc">Parse miniSEED from a buffer.</div><div class="ttdef"><b>Definition:</b> parseutils.c:61</div></div>
<div class="ttc" id="agroup__trace-list_html_ga28697b648a1390ae480fdcf75a478079"><div class="ttname"><a href="group__trace-list.html#ga28697b648a1390ae480fdcf75a478079">mstl3_pack</a></div><div class="ttdeci">int64_t mstl3_pack(MS3TraceList *mstl, void(*record_handler)(char *, int, void *), void *handlerdata, int reclen, int8_t encoding, int64_t *packedsamples, uint32_t flags, int8_t verbose, char *extra)</div><div class="ttdoc">Pack MS3TraceList data into miniSEED records.</div><div class="ttdef"><b>Definition:</b> tracelist.c:1896</div></div>
</div><!-- fragment --><h1><a class="anchor" id="example-lm_sids"></a>
Working with Source Identifiers</h1>
<p >An example of mapping between source identifiers (SIDs) and SEED identifier codes.</p>
<div class="fragment"><div class="line"><span class="comment">/***************************************************************************</span></div>
<div class="line"><span class="comment"> * A program illustrating mapping source identifiers and SEED codes</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * This file is part of the miniSEED Library.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Copyright (c) 2020 Chad Trabant, IRIS Data Management Center</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span></div>
<div class="line"><span class="comment"> * you may not use this file except in compliance with the License.</span></div>
<div class="line"><span class="comment"> * You may obtain a copy of the License at</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *   http://www.apache.org/licenses/LICENSE-2.0</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Unless required by applicable law or agreed to in writing, software</span></div>
<div class="line"><span class="comment"> * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></div>
<div class="line"><span class="comment"> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></div>
<div class="line"><span class="comment"> * See the License for the specific language governing permissions and</span></div>
<div class="line"><span class="comment"> * limitations under the License.</span></div>
<div class="line"><span class="comment"> ***************************************************************************/</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="libmseed_8h.html">libmseed.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span></div>
<div class="line">map_sid (<span class="keywordtype">char</span> *original_sid)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">char</span> sid[<a class="code hl_define" href="libmseed_8h.html#a35732636583abd22ed0307c5d2576493">LM_SIDLEN</a>];</div>
<div class="line">  <span class="keywordtype">char</span> network[11];</div>
<div class="line">  <span class="keywordtype">char</span> station[11];</div>
<div class="line">  <span class="keywordtype">char</span> location[11];</div>
<div class="line">  <span class="keywordtype">char</span> channel[31];</div>
<div class="line">  <span class="keywordtype">int</span> rv;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* Parse network, station, location and channel from SID */</span></div>
<div class="line">  rv = <a class="code hl_function" href="group__string-functions.html#gafbfea7ed4278b28c17da07fa7319b189">ms_sid2nslc</a> (original_sid, network, station, location, channel);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (rv)</div>
<div class="line">  {</div>
<div class="line">    printf (<span class="stringliteral">&quot;Error returned ms_sid2nslc()\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* Construct SID from network, station, location and channel */</span></div>
<div class="line">  rv = <a class="code hl_function" href="group__string-functions.html#ga58219d2fde492eefb982d659fa3a7b67">ms_nslc2sid</a> (sid, <span class="keyword">sizeof</span>(sid), 0, network, station, location, channel);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (rv &lt;= 0)</div>
<div class="line">  {</div>
<div class="line">    printf (<span class="stringliteral">&quot;Error returned ms_nslc2sid()\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  printf (<span class="stringliteral">&quot;Original SID: &#39;%s&#39;\n&quot;</span>, original_sid);</div>
<div class="line">  printf (<span class="stringliteral">&quot;  network: &#39;%s&#39;, station: &#39;%s&#39;, location: &#39;%s&#39;, channel: &#39;%s&#39;\n&quot;</span>,</div>
<div class="line">          network, station, location, channel);</div>
<div class="line">  printf (<span class="stringliteral">&quot;  SID: &#39;%s&#39;\n&quot;</span>, sid);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span></div>
<div class="line">main (<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">char</span> *sid;</div>
<div class="line">  <span class="keywordtype">int</span> idx;</div>
<div class="line"> </div>
<div class="line">  sid = <span class="stringliteral">&quot;FDSN:NET_STA_LOC_C_H_N&quot;</span>;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (map_sid (sid))</div>
<div class="line">  {</div>
<div class="line">    printf (<span class="stringliteral">&quot;Error with map_sid()\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span> 1;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* Map each value give on the command line */</span></div>
<div class="line">  <span class="keywordflow">if</span> (argc &gt; 1)</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordflow">for</span> (idx = 1; idx &lt; argc; idx++)</div>
<div class="line">    {</div>
<div class="line">      <span class="keywordflow">if</span> (map_sid (argv[idx]))</div>
<div class="line">      {</div>
<div class="line">        printf (<span class="stringliteral">&quot;Error with map_sid()\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="agroup__string-functions_html_ga58219d2fde492eefb982d659fa3a7b67"><div class="ttname"><a href="group__string-functions.html#ga58219d2fde492eefb982d659fa3a7b67">ms_nslc2sid</a></div><div class="ttdeci">int ms_nslc2sid(char *sid, int sidlen, uint16_t flags, char *net, char *sta, char *loc, char *chan)</div><div class="ttdoc">Convert network, station, location and channel to an FDSN Source ID.</div><div class="ttdef"><b>Definition:</b> genutils.c:281</div></div>
<div class="ttc" id="agroup__string-functions_html_gafbfea7ed4278b28c17da07fa7319b189"><div class="ttname"><a href="group__string-functions.html#gafbfea7ed4278b28c17da07fa7319b189">ms_sid2nslc</a></div><div class="ttdeci">int ms_sid2nslc(char *sid, char *net, char *sta, char *loc, char *chan)</div><div class="ttdoc">Parse network, station, location and channel from an FDSN Source ID.</div><div class="ttdef"><b>Definition:</b> genutils.c:151</div></div>
<div class="ttc" id="alibmseed_8h_html_a35732636583abd22ed0307c5d2576493"><div class="ttname"><a href="libmseed_8h.html#a35732636583abd22ed0307c5d2576493">LM_SIDLEN</a></div><div class="ttdeci">#define LM_SIDLEN</div><div class="ttdoc">Length of source ID string.</div><div class="ttdef"><b>Definition:</b> libmseed.h:137</div></div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- GitHub corner from https://github.com/tholman/github-corners -->
<a href="https://github.com/iris-edu/libmseed" class="github-corner" aria-label="View source on GitHub"><svg width="75" height="75" viewBox="0 0 250 250" style="fill:#442487; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
<a href="https://ds.iris.edu"><img style="position: absolute; top: 0; border: 0; right: 75px; height:75px;" src="https://www.iris.edu/hq/files/publications/logos/iris_color_screen.png"></a>
