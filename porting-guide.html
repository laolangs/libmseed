<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>libmseed: Guide for porting from earlier libmseed versions</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">libmseed<span id="projectnumber">&#160;3.0.10</span>
   </div>
   <div id="projectbrief">The miniSEED data format library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Guide for porting from earlier libmseed versions </div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#porting-overview">Overview and approach</a><ul><li class="level2"><a href="#porting-important">Most important changes that commonly need attention</a></li>
<li class="level2"><a href="#porting-other">Other changes that may need attention</a></li>
<li class="level2"><a href="#porting-data-model-change">Ramifications for change in data model</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="porting-overview"></a>
Overview and approach</h1>
<p >This page contains a description of major API changes from version 2 to 3 of the library.</p>
<p >The recommended approach to porting is as follows:</p>
<ol type="1">
<li>Quickly read through the <a class="el" href="porting-guide.html#porting-important">Most important changes that commonly need attention</a>, changing anything in the calling program that is obvious.</li>
<li>Try compiling the target program with the new library and fix any identified problems.</li>
<li>Read <a class="el" href="porting-guide.html#porting-other">Other changes that may need attention</a> to understand other changes that may not be identified at compile time but may yet effect the program.</li>
</ol>
<h2><a class="anchor" id="porting-important"></a>
Most important changes that commonly need attention</h2>
<ul>
<li>Change <code>MSRecord</code> structure type usage with <a class="el" href="group__miniseed-record.html#struct_m_s3_record" title="miniSEED record container">MS3Record</a>, which has similar (but not the same) members.</li>
<li>Change <code>MSTraceList</code>, <code>MSTraceID</code>, and <code>MSTraceSeg</code> structure types usage with <a class="el" href="group__trace-list.html#struct_m_s3_trace_list" title="Container for a collection of continuous trace segment, linkable.">MS3TraceList</a>, <a class="el" href="group__trace-list.html#struct_m_s3_trace_i_d" title="Container for a trace ID, linkable.">MS3TraceID</a>, and <a class="el" href="group__trace-list.html#struct_m_s3_trace_seg" title="Container for a continuous trace segment, linkable.">MS3TraceSeg</a>, which have similar (but not the same) members.</li>
<li>Convert usage of MSTraceGroups to MS3TraceLists. Trace Groups are no longer supported. The <a class="el" href="page-examples.html">Examples</a> page contains examples of using <a class="el" href="group__trace-list.html">Trace List</a> functionality.</li>
<li>Convert all <code>hptime_t</code> typed variables to <code>nstime_t</code> type. <dl class="section note"><dt>Note</dt><dd>the <code>nstime_t</code> type is a nanosecond epoch value, whereas the previous <code>hptime_t</code> was a microsecond epoch value. Careful review is required for values used by a program directly (they really <em>should not</em> be).</dd></dl>
</li>
<li>Review and change functions with <code>hptime</code> in the name to their closest equivalent for the new <code>nstime</code> version. See <a class="el" href="group__time-related.html">Time definitions and functions</a>.</li>
<li>Change all usage of <code>ms_hptime2isotimestr()</code>, <code>ms_hptime2mdtimestr()</code>, and <code>ms_hptime2seedtimestr()</code> functions to use <a class="el" href="group__time-related.html#gafc71e63c89345baaba450780d1066235" title="Convert an nstime_t to a time string.">ms_nstime2timestr()</a>, which has enumerated flags to specify the time string format. In general:<ul>
<li>ms_hptime2isotimestr() becomes ms_nstime2timestr(nstime, timestr, ISOMONTHDAY, subsecond)</li>
<li>ms_hptime2mdtimestr() becomes ms_nstime2timestr(nstime, timestr, ISOMONTHDAY_SPACE, subsecond)</li>
<li>ms_hptime2seedtimestr() becomes ms_nstime2timestr(nstime, timestr, SEEDORDINAL, subsecond)</li>
</ul>
</li>
<li>The <em>time format</em> and <em>subseconds</em> flags have changed from integers to <code>enum</code> values, review and change calling of <code><a class="el" href="group__time-related.html#gafc71e63c89345baaba450780d1066235" title="Convert an nstime_t to a time string.">ms_nstime2timestr()</a></code>, <code><a class="el" href="group__trace-list.html#gad6999931a86547276deb85b36145ccd6" title="Print trace list summary information for a MS3TraceList.">mstl3_printtracelist()</a></code>, <code><a class="el" href="group__trace-list.html#ga902e150fe0f1a1d0fc140469507a82ce" title="Print SYNC trace list summary information for a MS3TraceList.">mstl3_printsynclist()</a></code>, and <code><a class="el" href="group__trace-list.html#ga280fc1708baa319bcd89f691968ce3ef" title="Print gap/overlap list summary information for a MS3TraceList.">mstl3_printgaplist()</a></code>. <dl class="section note"><dt>Note</dt><dd>If the above functions are simply renamed and the flag values are not changed to use the enumerated types, leaving integers as arguments, there may be a <b>non-obvious bug</b>. Most compilers will quiety accept an integer for the enum argument, which may or may not match the desired time format or subsecond handling. Assume <em>not</em>.</dd></dl>
</li>
<li>Adapt to new identification of a record source. The channel identification has changed from <code>NN_SSS_LL_CHA</code>, commonly printed in library console output and logging, to an URI-style Source Identifier (SID) with the pattern <code>XFDSN:NN_SSS_LL_C_H_A</code>. The following helper functions are available for mapping between the new URI-based scheme and the traditional SEED networ, station, location, channel scheme:<ul>
<li><a class="el" href="group__string-functions.html#gafbfea7ed4278b28c17da07fa7319b189" title="Parse network, station, location and channel from an FDSN Source ID.">ms_sid2nslc()</a>: convert SID to traditional SEED identifiers</li>
<li><a class="el" href="group__string-functions.html#ga58219d2fde492eefb982d659fa3a7b67" title="Convert network, station, location and channel to an FDSN Source ID.">ms_nslc2sid()</a>: convert traditional SEED identifiers to an SID</li>
<li><a class="el" href="group__string-functions.html#gad89ccaaeeeca1418dbf879d46ae98994" title="Convert SEED 2.x channel to extended channel.">ms_seedchan2xchan()</a>: convert SEED channel to SID-style channel components</li>
<li><a class="el" href="group__string-functions.html#gabbc0c24e7c7211ae98de00dd3dd7c284" title="Convert extended channel to SEED 2.x channel.">ms_xchan2seedchan()</a>: convert SID band, source and position to SEED channel</li>
</ul>
</li>
<li><p class="startli">The new data model allows sampling rate to be specified in samples/second (Hertz) or sampling period (seconds). This is represented in the <em>samprate</em> values, such as <a class="el" href="group__miniseed-record.html#a7578e312e666fcc80cc07fd324201d4e" title="Nominal sample rate as samples/second (Hz) or period (s)">MS3Record.samprate</a>, as follows:</p><ul>
<li><code>samprate</code> &gt;= 0.0 is a rate in samples/second (Hertz)</li>
<li><code>samprate</code> &lt; 0.0 is a (negated) sampling period in seconds</li>
</ul>
<p class="startli">It is common that rates equal to or greater than 1 Hz are reprensented in samples/second and rates less than 1 Hz are represented as a period.</p>
<p class="startli">Applications that must consistenly have access to the samples/second representation may use the <a class="el" href="group__miniseed-record.html#gaa7cb500cce045ccb5a40af21a6810d92" title="Calculate sample rate in samples/second (Hertz) for a given MS3Record.">msr3_sampratehz()</a> function.</p>
</li>
</ul>
<h2><a class="anchor" id="porting-other"></a>
Other changes that may need attention</h2>
<ul>
<li>The supported range for the internal time scale is reduced from year 5000 to year 2262 (due to the change in time resolution). If an application previously used the library with years beyond 2262, such programs should be adapted for this new limit.</li>
<li>The <code>off_t</code> type is no longer used by the library due to non-portable, inconsistent size. Instead, the <code>int64_t</code> type is used. Calling programs should adjust their usage accordingly. The API changed as follows:<ul>
<li>The global LM_SIZEOF_OFF_T is removed, no longer needed</li>
<li>The type of <em>fpos</em> (file position) arument of <a class="el" href="group__io-functions.html#ga120eaddf0e86963ad6764899b3783cad" title="Read miniSEED records from a file or URL.">ms3_readmsr()</a>, <a class="el" href="group__io-functions.html#gac67175755fed41e3e3beed8e27b82da9" title="Read miniSEED records from a file or URL in a thread-safe way.">ms3_readmsr_r()</a>, and <a class="el" href="group__io-functions.html#gad4e1882600317031345ae83b44bd48fd" title="Read miniSEED records from a file or URL with optional selection.">ms3_readmsr_selection()</a> has changed</li>
<li>Some internal functions and structures rarely used by callers were changed</li>
</ul>
</li>
<li>The <code>flag</code> typedef is now legacy, you may wish to convert to directly using int8_t</li>
<li>The time and sample rate tolerances, specified as <code>timetol</code> and <code>sampratetol</code> arguments, have been replaced with <a class="el" href="struct_m_s3_tolerance.html" title="Callback functions that return time and sample rate tolerances.">MS3Tolerance</a> which identifies callback functions that return tolerances for a specified <a class="el" href="group__miniseed-record.html#struct_m_s3_record" title="miniSEED record container">MS3Record</a>.</li>
<li>The SEED 2.x data quality identifiers no longer exist in the new data model. The library maps these values to integer publications versions as follows:<ul>
<li>Quality <b>R</b> =&gt; <b>1</b> </li>
<li>Quality <b>D</b> =&gt; <b>2</b> </li>
<li>Quality <b>Q</b> =&gt; <b>3</b> </li>
<li>Quality <b>M</b> =&gt; <b>4</b> </li>
<li>Unknown quality =&gt; <b>0</b> </li>
</ul>
</li>
<li><p class="startli">For applications that need access to flags in the miniSEED 2.x fixed header, they have moved to the following locations:</p><ul>
<li>Activity flags (field 12):<ul>
<li>Bit 0 (calibration signals present) =&gt; Fixed header flags, bit 0</li>
<li>Bit 1 (time correction applied), not retained</li>
<li>Bit 2 (begining of event) =&gt; Extra header FDSN.Event.Begin</li>
<li>Bit 3 (end of event) =&gt; Extra header FDSN.Event.End</li>
<li>Bit 4 (positive leap second included) =&gt; Extra header FDSN.Time.LeapSecond</li>
<li>Bit 5 (negative leap second included) =&gt; Extra header FDSN.Time.LeapSecond</li>
<li>Bit 6 (event in progress) =&gt; Extra header FDSN.Event.InProgress</li>
</ul>
</li>
<li>I/O flags (field 13):<ul>
<li>Bit 0 (Station volume parity error) =&gt; Extra header FDSN.Flags.StationVolumeParityError</li>
<li>Bit 1 (Long record read) =&gt; Extra header FDSN.Flags.LongRecordRead</li>
<li>Bit 2 (Short record read) =&gt; Extra header FDSN.Flags.ShortRecordRead</li>
<li>Bit 3 (Start of time series) =&gt; Extra header FDSN.Flags.StartOfTimeSeries</li>
<li>Bit 4 (End of time series) =&gt; Extra header FDSN.Flags.EndOfTimeSeries</li>
<li>Bit 5 (Clock locked) =&gt; Fixed header flags, bit 2</li>
</ul>
</li>
<li>Data quality flags (field 14):<ul>
<li>Bit 0 (Amplifier saturation detected) =&gt; Extra header FDSN.Flags.AmplifierSaturation</li>
<li>Bit 1 (Digitizer clipping detected) =&gt; Extra header FDSN.Flags.DigitizerClipping</li>
<li>Bit 2 (Spikes detected) =&gt; Extra header FDSN.Flags.Spikes</li>
<li>Bit 3 (Glitches detected) =&gt; Extra header FDSN.Flags.Glitches</li>
<li>Bit 4 (Missing/padded data present) =&gt; Extra header FDSN.Flags.MissingData</li>
<li>Bit 5 (Telemetry synchronization error) =&gt; Extra header FDSN.Flags.TelemetrySyncError</li>
<li>Bit 6 (Digital filter may be charging) =&gt; Extra header FDSN.Flags.FilterCharging</li>
<li>Bit 7 (Time tag questionable) =&gt; Fixed header flags, bit 1</li>
</ul>
</li>
</ul>
<p class="startli">The existence of these boolean extra header values can be tested with <a class="el" href="group__extra-headers.html#ga1ddeb42ec0313007042a422f7898c8c4" title="A simple wrapper to test existence of an extra header.">mseh_exists()</a>.</p>
</li>
</ul>
<h2><a class="anchor" id="porting-data-model-change"></a>
Ramifications for change in data model</h2>
<p >With an internal change in the data model, from miniSEED 2 to version 3, results in the following consequences:</p>
<ul>
<li>Version 2.x data quality indicators (D, R, Q and M) are no longer supported. These are mapped to version 3 publication versions.</li>
<li>Version 2.x beam blockettes (400 &amp; 405) are no longer supported, they will be dropped if reading records that contain such blockettes.</li>
<li>Version 2.x opaque blockettes (2000) are no longer supported, they will be dropped if reading records that contain such blockettes. Note that the format version 3 <a class="el" href="group__extra-headers.html">Extra Headers</a> functionality can be used to contain most arbitrary data.</li>
<li>Version 2.x timing blockettes (500) contain one "Clock Model" designation per blockette, potentially allowing for multiple designations in a single record. Upon reading such a record, only the last clock model is retained (in the <code>FDSN.Clock.Model</code> <a class="el" href="group__extra-headers.html">Extra Headers</a>).</li>
<li>Version 2.x sequence numbers, as six digit ASCII string, are not retained. In the new format these values may be placed in <a class="el" href="group__extra-headers.html">Extra Headers</a> by a calling program as desired. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- GitHub corner from https://github.com/tholman/github-corners -->
<a href="https://github.com/iris-edu/libmseed" class="github-corner" aria-label="View source on GitHub"><svg width="75" height="75" viewBox="0 0 250 250" style="fill:#442487; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
<a href="https://ds.iris.edu"><img style="position: absolute; top: 0; border: 0; right: 75px; height:75px;" src="https://www.iris.edu/hq/files/publications/logos/iris_color_screen.png"></a>
